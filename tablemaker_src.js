// *--------------------------------------------------------------------------------------------------*
// * tablemaker.js : 書き込み欄で文字列を範囲選択し右クリックメニューでコマンド実行して表に変換する   *
// *  Author: ◆IJa6whaByU                                                                            *
// *    Date: 2013/01/30                                                                              *
// * Version: 1.00 (this is βversion)                                                                *
// * License: JaneView License                                                                        *
// * !!■注意■!! JaneViewでtablemaker_src.jsを実行する場合文字コード「Shift_JIS」でないと動きません  *
// *              通常はコンパイル済みのtablemaker.jsを使用して下さい                                 *
// *              使い方は同封のtablemaker-readme.txtを参考にしてください                             *
// *--------------------------------------------------------------------------------------------------*
(function () { var global = this, DEBUG = false, JANEVIEW = false, MODE = main;

// --[ 設定ここから ]--------------------------------------------------------

// デバッグ時は以下のモードのいずれかの先頭の「//」を消す
//MODE = timewatch;           // 処理時間計測モード
//MODE = main,DEBUG=true;     // ユーザー用のデバッグモード。通常実行だけどデバッグ文字列をJaneViewのトレース欄、又はV2Cのスクリプトコンソールウィンドウに出力する
//MODE = debug,DEBUG=true;    // 開発者のデバッグ用。入力文字固定で、書き込み欄の本文に出力結果を書き出す。

// --[ 設定ここまで ]--------------------------------------------------------

try { if (ScriptEngine != undefined) JANEVIEW = true; } catch(e) {}

// 変更しないで下さい
this.USE_UNICODE = false;
this.TAILCUT = false;
this.SEPARATOR = '|';
this.USER_KEISEN = '┌&br;┬&br;┐&br;─&br;├&br;┼&br;┤&br;│&br;└&br;┴&br;┘&br;┏&br;┳&br;┓&br;━&br;┣&br;╋&br;┫&br;┃&br;┗&br;┻&br;┛&br;┠&br;╂&br;┨&br;┰&br;┸&br;┝&br;┿&br;┥&br;┯&br;┷';
this.STYLE = 0;
this.PREVIEW = false;
this.Run = MODE;
this.DEBUG = (DEBUG == true && (MODE != timewatch));
function log(format /*, ...*/)
{
	var args = arguments;
	var message = String(format).replace(/\{(\d)\}/g, function(m, c) { return args[parseInt(c) + 1]; });
	if (JANEVIEW) {
		JaneScript.Log("[tablemaker.js] " + message);
	} else {
		v2c.println("[tablemaker.js] " +message);
	}
}

var STOREMES = [];
function put(format /*, ...*/)
{
	var args = arguments;
	var message = String(format).replace(/\{(\d)\}/g, function(m, c) { return args[parseInt(c) + 1]; });
	STOREMES.push(message);
}
function getStoreString()
{
	var ret = '';
	while(STOREMES.length > 0) {
		ret += STOREMES.shift();
	}
	return ret;
}
function logFunc(func, format /*, ...*/)
{
	var args = arguments;
	var message = String(format).replace(/\{(\d)\}/g, function(m, c) { return args[parseInt(c) + 2]; });

	var name = func;
	if (typeof func == 'function') {
		name = func.name;
	}
	if (JANEVIEW) {
		JaneScript.Log("[tablemaker.js:" + name + "()]" + message);
	} else { 
		v2c.println("[tablemaker.js:" +  name + "()] " + message);
	}
}

var LEFT = 1, RIGHT = 2, HEAD = 4, TAIL = 8, CENTER = 16;	// 位置調整用定数

var CHARDOTS =
[
	// Fantasioso Acsii Art ( http://www.geocities.jp/file_file_file_aaa/guide/glinedot.html )
	"",		// 0 dot
	"",
	"",
	"',.:;il",
	"!Ij{|}ﾞﾟＩｉｊｌ|",
	"()[]_fｆｔ ",		// 5 dot
	"rtｒ",
	"?^`gksxz~｡｢｣､･ｨｮﾄﾐ",
	"\"#$%*+-/0123456789<=>\abcdehnopquvyｧｩｪｫｬｭｯﾉﾋﾒﾖﾘ・：；゛゜´｀¨＾‐‘’“”（）〔〕［］｛｝〈〉《》「」『』【】†‡¶ｖｘｙｚ",
	"EFJLTYZｦｲｶｸｺｼｿﾀﾇﾌﾗﾚﾛﾜﾝａｃｅｇｓく",
	"&ABDHKNPRSUVXwｰｱｳｴｵｷｹｽｾﾁﾂﾃﾅﾆﾈﾊﾍﾎﾏﾓﾕＦＪＬＴＸＹＺｂｄｈｋｎｏｐｑｕぅィトョ",		// 10 dot
	"@CGOQｻﾑﾔﾙ、。，．ゞ０１２３４５６７８９ＡＥＰＶうドノミ　",
	"MWmヽヾゝＢＣＤＧＨＫＮＲＳＵｗぁぇさしじとょりァゥェタッヒメヨリヮヵヶ",
	"ＯＱぃぉぐこっもらイォカクコソヌフャュラヲ",
	"えきぎござちぢてでどなまゃゅよるろゎをアエゴシジスゾツテビピブプマモレロン",
	"ーＭｍあいおけすそぞただつづにひびぴんウオガキギグケゲズセダチヂヅデナニネヘベペホボポユワヴ"		// 15 dot
];

var UNICODE_DOTS = 
[
	[
	0,16,8,8,8,8,8,8,8,0,0,8,8,0,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,0,0,5,4,8,8,8,8,10,3,5,5,8,8,3,8,3,8,8,8,8,8,8,8,8,8,8,8,3,3,8,8,8,7,11,10,10,11,10,9,9,11,10,4,9,10,9,12,10,11,10,11,10,10,9,10,10,12,10,9,9,5,8,5,7,5,7,8,8,8,8,8,5,7,8,3,4,7,3,12,8,8,8,8,6,7,6,8,8,10,7,8,7,4,4,4,7,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,4,8,11,8,9,4,16,8,11,6,11,10,8,11,11,16,16,4,4,8,8,8,3,3,4,6,11,8,8,8,7,10,10,10,10,10,10,11,11,9,9,9,9,5,5,7,5,10,10,11,11,11,11,11,16,11,10,10,10,10,9,9,9,8,8,8,8,8,8,11,8,8,8,8,8,5,5,7,6,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,8,
	10,8,10,8,11,8,11,8,11,8,11,8,11,8,10,10,10,9,9,8,9,8,9,8,9,8,9,8,11,7,11,7,11,7,11,7,10,8,10,8,7,7,6,6,7,7,4,4,4,3,11,6,9,7,10,7,7,9,4,9,4,9,5,9,5,9,5,10,8,10,8,10,8,8,10,8,11,8,11,8,11,8,11,11,10,6,10,6,10,7,10,7,10,7,10,7,10,7,9,6,9,6,9,6,10,8,10,8,10,8,10,8,10,8,10,8,11,10,9,8,9,9,7,9,7,9,7,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,10,11,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,7,7,10,8,10,8,11,11,11,8,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,9,10,8,8,11,7,7,11,8,6,10,8,8,8,10,8,8,8,4,6,3,6,6,6,10,11,11,11,10,10,8,8,11,9,9,6,6,8,6,6,7,7,8,8,7,10,10,9,10,6,6,9,8,8,9,11,8,9,9,7,8,8,8,8,8,8,8,7,7,10,8,7,8,6,10,8,8,11,11,11,11,11,11,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,5,3,3,3,4,4,5,5,7,7,7,7,7,7,3,6,16,16,3,16,4,4,4,4,4,4,4,4,4,4,7,3,4,4,8,7,8,7,7,7,7,7,7,11,11,11,11,11,4,4,4,4,4,4,4,4,4,4,4,5,5,4,3,4,4,4,4,5,5,4,
	5,5,7,7,6,0,7,0,6,0,0,7,7,0,0,7,0,0,0,0,0,0,0,0,4,4,6,0,2,6,6,6,6,0,0,0,6,3,0,0,0,3,7,0,7,0,0,7,7,0,0,0,7,0,0,0,0,2,7,7,7,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,7,7,7,5,5,7,7,7,7,4,7,7,7,3,7,7,7,7,7,5,6,10,3,10,11,7,7,11,7,11,11,5,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,16,16,16,16,16,16,16,6,9,8,7,8,6,8,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,9,16,16,16,16,16,16,16,6,8,7,8,10,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,7,7,7,7,7,7,
	7,16,8,9,9,10,4,5,9,11,11,8,10,7,9,10,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,16,8,6,7,7,3,5,5,9,9,8,8,7,8,8,11,10,10,9,11,10,10,8,11,9,11,8,11,9,10,8,11,10,11,8,11,8,11,8,11,11,11,8,11,10,11,10,11,8,9,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,8,10,8,11,11,9,7,10,8,10,8,11,9,11,10,10,9,11,9,11,10,11,9,11,8,9,8,10,9,10,9,10,9,11,9,10,8,10,8,10,8,11,9,11,9,4,11,11,10,8,7,7,11,9,7,7,10,8,7,7,7,10,8,10,8,11,11,9,8,9,8,9,8,11,11,9,7,9,8,10,9,10,9,11,8,11,8,11,8,7,7,11,8,11,8,11,8,10,8,7,7,11,10,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,8,8,9,8,8,8,8,10,8,8,6,11,8,9,7,8,9,9,9,9,9,8,9,8,9,8,9,8,9,8,8,9,7,10,8,9,9,7,7,3,3,4,5,4,5,6,7,11,7,7,7,7,7,7,7,9,7,7,4,11,7,7,7,6,8,6,8,4,8,6,7,6,11,6,7,7,8,11,7,7,5,11,8,7,9,8,7,5,5,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,0,0,8,8,8,5,8,3,8,8,5,8,8,5,8,7,7,7,7,7,7,7,7,9,9,6,9,9,4,5,9,9,4,8,8,8,9,9,5,5,10,9,9,9,7,8,9,8,11,10,7,7,7,7,7,8,8,8,3,5,7,7,7,7,7,7,7,7,7,7,7,
	11,18,14,11,7,7,7,7,0,7,7,6,7,4,7,7,7,7,7,7,7,7,0,0,0,0,0,4,7,7,4,7,7,5,3,3,5,3,8,3,9,4,9,9,7,7,7,4,4,6,6,10,10,13,13,7,7,7,7,0,0,0,0,0,3,9,7,7,6,4,6,4,5,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,3,4,5,9,7,7,3,3,3,0,4,5,5,8,9,9,9,9,9,9,9,9,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,6,6,6,6,6,6,6,6,6,10,10,10,13,13,7,7,9,9,9,9,9,9,7,7,7,14,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,5,7,4,4,4,4,5,5,5,5,5,5,5,5,8,9,8,5,8,8,10,10,3,4,7,7,7,7,7,7,7,13,13,7,7,7,7,7,7,0,0,7,7,7,7,7,7,7,4,6,7,7,7,7,7,7,7,7,7,7,10,13,7,5,4,5,
	6,3,3,3,3,4,4,4,4,4,5,7,6,6,7,7,9,6,8,15,15,4,4,8,5,3,7,9,9,3,11,10,7,8,8,7,7,9,8,8,10,6,4,8,7,8,15,4,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,6,8,9,9,9,9,9,9,9,9,7,7,4,4,6,10,7,7,7,9,9,7,7,7,4,4,6,6,6,6,6,6,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,9,10,9,9,8,7,7,5,6,6,8,7,7,7,8,13,5,7,9,9,6,7,7,7,6,6,8,9,13,13,13,7,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,6,6,6,6,6,6,6,6,6,3,8,5,7,7,7,8,6,8,5,5,7,6,4,9,5,8,8,7,9,6,7,6,7,6,6,6,6,6,6,5,5,5,6,6,6,6,6,6,6,4,6,4,4,7,11,6,6,5,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,8,8,12,9,9,13,7,7,7,9,11,9,7,7,7,7,13,13,13,13,9,10,8,8,7,8,9,9,10,8,7,8,7,7,10,8,8,7,8,8,8,7,9,7,9,9,8,6,6,9,9,9,7,9,7,9,7,7,7,8,6,11,12,11,8,8,8,8,8,8,8,8,11,11,11,11,8,7,7,12,8,8,8,8,7,7,7,9,10,8,9,7,7,9,8,11,9,8,8,5,7,6,6,6,6,6,6,6,6,6,6,4,4,9,7,7,7,7,7,7,7,7,8,9,7,7,7,7,7,12,12,7,9,11,6,7,8,9,8,8,7,7,7,9,7,7,8,9,9,7,7,7,8,6,7,8,8,9,6,7,8,6,6,8,7,6,7,7,7,7,9,7,8,7,7,7,7,7,7,7,7,7,7,7,6,7,7,7,6,10,10,10,7,7,7,7,7,7,11,10,7,7,14,14,7,7,7,7,7,7,7,7,7,7,10,7,7,7,7,8,6,7,7,8,8,7,7,7,7,7,6,6,8,6,7,9,6,9,8,7,7,11,11,8,9,10,6,7,5,10,7,7,7,7,7,
	7,8,8,12,7,9,12,10,10,8,8,7,7,7,7,7,9,7,7,8,9,8,8,9,8,7,8,8,8,8,8,8,8,8,8,7,8,8,8,8,8,7,8,7,8,7,8,8,8,7,8,8,7,7,8,7,8,8,7,7,8,7,11,11,11,8,8,7,7,7,7,8,8,7,7,8,8,8,7,7,7,0,7,7,7,7,7,7,7,8,9,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,7,8,16,0,7,7,7,7,7,7,7,7,7,7,7,8,8,11,7,11,14,8,9,8,11,11,10,11,7,11,11,14,7,14,14,7,10,10,9,7,10,9,9,10,10,7,7,7,8,10,9,9,8,9,9,7,9,7,10,10,9,9,7,7,10,10,7,9,9,9,9,7,7,7,8,6,11,10,11,8,8,8,8,8,7,8,8,11,7,11,11,8,7,7,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,10,10,8,8,7,7,8,8,8,8,8,8,8,8,8,8,7,11,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,9,13,13,7,8,10,8,8,8,8,8,7,7,7,8,9,7,7,7,8,8,8,8,8,8,7,7,7,8,7,7,8,7,7,8,7,7,7,8,7,7,8,9,7,8,8,8,8,7,8,7,7,7,8,8,8,7,7,7,9,6,11,9,12,9,9,9,0,7,7,15,15,7,7,17,17,9,7,7,7,7,7,7,7,7,9,11,7,7,7,7,7,7,7,8,8,7,0,0,7,7,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,8,7,14,16,13,10,13,16,7,7,7,10,10,12,7,13,13,25,10,7,7,7,12,9,7,12,7,15,11,7,7,7,18,10,7,7,7,9,14,9,7,7,7,12,12,7,11,13,13,12,13,14,17,19,21,7,7,7,7,16,11,9,15,19,7,7,7,19,18,23,7,26,25,32,9,7,7,13,7,7,7,7,7,7,22,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,10,11,11,10,14,15,10,14,15,12,11,13,12,16,27,11,16,24,14,12,7,7,7,7,7,
	7,11,14,10,7,9,9,8,10,8,11,15,9,7,8,8,8,7,8,8,9,7,9,7,13,8,8,8,8,15,10,8,7,8,8,8,8,8,8,8,8,7,8,8,8,8,13,15,7,9,8,7,7,8,7,8,8,12,7,7,7,10,12,8,8,12,16,12,15,7,8,8,8,7,8,8,11,8,7,7,7,7,7,7,7,8,8,7,8,8,7,7,7,7,7,7,19,13,0,0,7,7,7,7,8,5,7,8,7,6,8,7,7,7,7,7,7,7,7,7,6,4,6,9,8,9,10,10,7,7,14,11,7,8,8,8,11,13,15,12,8,7,8,8,8,7,8,8,8,7,9,8,9,8,8,8,8,13,11,8,8,8,8,8,8,8,8,8,8,7,8,8,8,8,12,13,8,8,8,8,7,8,8,8,8,8,7,7,8,6,16,11,16,12,16,11,14,7,10,15,14,7,18,23,15,13,7,7,7,7,7,7,7,13,12,7,7,7,7,7,7,7,8,7,15,11,0,0,7,7,8,8,8,8,8,8,8,8,8,8,7,6,11,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,15,13,7,18,19,14,23,10,19,13,14,7,18,18,25,7,10,17,19,13,14,11,17,12,14,19,10,19,17,7,9,15,16,16,12,10,8,11,11,7,14,14,16,9,10,14,10,10,11,10,10,15,12,14,15,18,7,7,7,7,15,13,12,13,14,15,7,7,16,15,24,7,23,22,25,9,7,7,7,7,7,7,7,7,7,17,7,7,7,7,7,7,7,7,13,15,0,0,7,7,7,12,16,14,10,9,15,10,15,13,12,11,16,13,12,14,7,7,7,15,18,13,10,13,13,14,7,7,11,11,7,7,11,10,10,7,7,8,13,12,16,10,14,7,8,14,8,8,13,7,7,7,10,8,8,8,8,10,7,8,8,13,12,10,9,7,8,8,8,12,8,9,8,5,8,10,7,7,8,7,8,8,8,8,8,7,7,9,7,7,7,8,8,8,8,9,8,7,7,7,7,7,7,7,7,11,11,11,7,7,7,7,7,7,11,14,14,21,18,19,19,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,15,12,15,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,8,5,6,8,7,7,9,9,7,7,6,8,10,9,7,7,7,7,6,8,7,7,7,7,8,8,7,7,7,6,7,6,7,6,8,8,6,7,9,6,7,6,5,7,5,12,7,7,7,7,7,7,7,7,7,7,7,10,5,8,5,6,6,5,6,7,7,7,7,7,7,7,7,7,7,7,8,8,9,9,6,9,8,7,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,8,7,9,7,7,6,8,7,8,7,7,9,7,7,7,7,7,7,9,10,9,9,7,9,9,9,10,10,10,10,7,9,9,8,7,8,7,8,7,7,9,9,7,8,8,6,5,7,6,13,7,7,7,7,7,7,7,7,7,6,7,7,5,10,5,5,4,7,7,7,7,7,7,7,7,7,7,7,9,9,7,9,8,8,10,9,9,11,7,7,15,15,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	6,5,8,8,7,3,7,11,3,6,7,2,2,2,3,2,2,3,12,8,3,6,7,7,10,5,3,8,8,3,7,7,4,4,5,4,6,5,5,5,5,4,7,7,7,8,7,7,7,7,7,7,3,5,7,5,5,5,11,11,5,5,9,9,5,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,7,7,7,7,5,5,5,5,5,5,5,5,5,5,5,5,5,5,8,5,5,5,5,5,6,5,5,5,5,5,6,7,7,7,7,5,5,5,5,5,5,5,5,7,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,7,5,5,8,6,8,8,6,4,5,8,5,7,7,7,7,7,6,7,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,6,6,10,6,6,9,10,7,5,11,6,6,9,6,6,9,6,9,9,9,5,9,6,6,6,7,6,6,7,6,9,6,7,7,6,6,6,9,6,6,6,8,5,4,7,7,7,
	16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,
	6,8,6,6,6,6,8,10,6,8,9,6,8,7,9,8,8,10,11,8,10,8,8,10,10,12,11,9,11,9,9,11,8,11,9,8,9,10,8,9,6,7,6,8,7,6,7,8,6,8,8,6,8,6,6,8,6,8,8,6,8,7,6,8,7,7,7,8,7,7,7,7,7,7,11,7,7,11,7,7,7,7,7,8,7,7,7,7,7,7,11,7,7,10,7,7,6,8,8,6,8,8,6,8,6,8,9,6,8,8,6,8,7,7,7,8,7,7,7,7,7,7,7,8,7,7,7,8,6,9,8,6,8,6,9,9,10,7,10,8,8,9,7,7,4,6,5,6,5,6,7,6,7,8,7,7,7,7,8,7,6,8,9,6,8,6,6,7,6,8,9,6,8,6,6,8,10,7,10,8,8,8,7,7,8,10,10,8,10,8,8,7,12,7,12,9,10,10,7,7,8,10,7,7,7,10,7,9,6,8,8,6,8,5,6,7,6,8,8,5,7,7,6,7,10,10,10,10,10,10,10,10,5,6,7,6,7,7,7,9,7,9,8,7,9,8,8,9,7,9,8,7,9,8,8,9,
	7,9,8,7,8,8,8,9,5,7,6,7,6,7,5,5,9,7,9,6,7,8,7,7,5,7,7,7,7,7,5,6,9,11,11,9,11,8,9,11,12,12,12,11,14,11,12,13,6,8,8,6,8,7,6,8,6,8,8,6,8,7,6,8,5,8,6,5,6,5,6,7,7,8,7,8,8,7,8,8,8,8,8,9,8,8,9,8,7,9,7,7,7,7,7,0,8,4,6,4,4,5,8,4,9,6,6,6,6,6,6,6,7,6,6,7,8,7,6,8,7,10,6,5,8,7,7,7,13,13,11,13,10,10,8,11,8,8,8,8,8,9,8,9,4,5,4,4,5,10,5,11,11,5,7,7,7,7,7,7,9,8,8,8,11,4,8,9,7,8,9,6,7,12,7,11,5,7,11,11,7,7,9,11,6,10,11,10,7,9,9,6,9,11,8,7,7,10,8,12,10,11,13,6,10,13,7,8,6,8,8,6,11,6,9,9,9,9,6,10,9,7,7,8,8,10,7,8,10,9,9,8,9,10,13,9,13,7,7,14,8,11,8,10,7,7,7,7,7,7,7,7,7,7,7,7,
	7,10,10,10,10,9,9,9,9,9,9,9,10,10,10,10,10,10,11,11,11,11,9,11,11,11,11,9,8,7,6,4,4,6,6,4,6,6,4,3,5,5,5,13,11,11,13,10,10,10,10,9,9,9,9,9,9,9,10,10,10,10,10,10,10,11,10,11,11,10,11,10,9,5,2,4,10,10,10,10,8,8,8,8,8,8,8,12,11,11,12,11,12,10,10,10,10,10,10,10,10,10,4,12,12,11,10,8,8,8,8,8,8,8,8,8,9,9,9,10,9,10,9,9,9,9,9,9,9,9,9,5,5,10,10,10,9,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,4,4,8,7,7,7,7,7,7,7,7,9,9,9,8,9,8,8,9,8,9,9,8,9,8,9,4,4,4,5,7,11,11,11,11,11,11,11,11,11,13,13,13,11,13,11,11,7,6,7,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,10,12,10,12,12,11,12,11,6,5,8,7,7,7,7,7,7,7,7,7,8,9,9,8,9,8,8,9,8,9,
	9,9,9,9,9,4,5,4,6,4,4,4,13,13,12,12,10,10,10,8,8,8,8,12,12,12,12,12,12,10,10,10,10,10,10,10,10,6,7,7,7,7,7,7,7,7,7,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,4,6,4,4,11,11,11,11,11,11,7,7,7,7,7,7,9,9,4,5,8,10,10,10,10,10,10,10,10,12,12,6,10,10,10,10,10,10,9,9,9,9,11,11,5,10,10,8,8,14,10,10,8,8,9,9,9,9,9,9,9,6,9,4,12,12,12,12,12,12,12,9,8,8,8,8,10,10,10,10,14,14,14,12,12,14,14,7,10,8,8,8,8,11,11,11,11,7,10,10,10,10,10,10,6,7,7,7,7,7,7,7,4,7,6,6,6,6,7,7,7,7,9,9,9,9,9,9,9,9,9,9,9,9,10,10,9,9,9,9,10,10,9,9,9,9,10,10,9,9,9,9,10,10,9,9,9,9,10,10,8,8,8,8,10,10,8,8,8,8,10,10,8,8,8,8,5,12,12,7,7,7,7,12,12,8,8,8,8,12,12,8,8,8,
	8,6,8,8,11,11,11,11,12,12,7,7,7,7,10,10,8,8,8,8,8,8,8,11,11,11,11,11,8,8,11,11,11,11,11,11,8,8,8,8,11,11,8,8,8,8,10,10,8,7,7,8,12,12,8,8,8,8,14,14,7,7,7,7,9,9,8,8,8,8,5,5,9,9,8,8,8,8,12,12,7,7,7,7,12,12,7,7,7,7,5,12,12,8,8,8,8,12,12,7,7,7,7,12,12,8,8,8,8,8,4,12,14,18,18,15,15,18,18,7,7,7,7,7,7,7,7,7,7,3,5,7,8,10,3,5,7,8,10,3,5,7,8,10,3,5,7,8,10,3,5,7,7,8,7,5,5,7,7,7,8,8,7,6,7,7,6,6,4,6,6,6,6,4,4,6,6,6,4,5,7,7,7,6,6,6,7,7,6,3,6,4,6,3,3,6,4,6,4,6,6,6,5,7,3,3,6,6,4,4,6,4,6,6,8,8,7,3,4,4,5,6,8,6,7,6,7,6,6,8,7,3,6,6,7,4,3,8,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,10,10,10,11,10,10,10,9,15,11,9,9,9,11,13,10,9,9,10,10,10,9,10,10,10,12,4,11,4,11,10,11,11,11,10,10,14,10,9,9,9,9,9,10,10,10,10,10,10,9,7,9,4,4,11,7,7,7,7,7,7,7,11,15,15,11,11,11,16,16,7,11,11,7,7,7,7,7,7,7,7,7,7,6,6,7,4,7,19,7,10,5,6,7,7,7,8,8,9,11,8,8,8,9,9,8,7,7,7,7,7,7,7,7,3,10,7,6,5,8,4,7,7,7,7,7,7,7,
	5,16,6,10,6,6,4,4,7,10,2,0,0,0,0,7,5,5,6,6,4,5,6,5,5,4,7,7,7,7,7,7,9,7,8,7,7,10,10,11,4,6,5,5,6,6,4,4,5,5,6,5,5,4,4,4,5,5,4,4,8,8,9,7,9,6,8,2,8,9,8,8,8,8,10,7,6,7,7,5,4,4,5,5,5,4,5,4,4,10,6,5,5,7,8,3,7,10,8,4,6,7,5,5,8,6,5,6,4,4,5,5,3,5,5,8,5,7,6,4,7,7,7,7,7,7,7,7,6,8,6,5,5,11,9,12,8,5,8,6,5,7,6,5,5,4,5,5,5,6,5,5,5,7,9,7,5,8,5,6,4,9,5,5,5,5,4,5,7,10,10,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,7,7,9,9,9,10,10,7,7,10,7,10,7,10,9,7,9,8,3,7,7,7,6,6,7,7,7,6,9,7,7,7,6,7,7,6,7,7,7,7,7,7,7,7,7,7,7,10,10,11,5,11,7,7,7,7,11,7,7,7,11,12,7,11,8,8,6,7,9,11,11,11,7,7,11,11,11,7,11,11,6,7,8,5,7,11,6,7,7,7,7,7,7,7,7,6,5,7,5,7,17,23,16,6,7,16,9,10,11,8,11,11,7,7,6,7,11,5,7,6,6,7,7,7,7,7,7,8,5,7,6,7,9,7,10,6,7,7,7,7,7,10,10,7,7,7,8,7,7,6,8,7,6,11,11,12,14,12,12,7,7,7,8,7,7,6,8,7,7,11,11,12,14,12,12,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,12,12,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,11,10,11,10,11,10,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,8,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,4,4,4,7,7,7,7,7,7,7,7,7,7,7,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,5,5,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,
	8,16,8,16,5,4,3,10,5,2,1,0,0,0,0,0,8,5,8,8,11,16,16,11,8,8,3,3,8,8,6,7,8,8,3,4,3,16,16,4,0,0,0,0,0,0,0,7,16,11,16,16,11,5,8,11,7,8,8,16,6,7,5,11,11,8,11,5,8,6,6,12,9,9,7,7,7,7,7,7,7,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,0,0,0,7,7,7,7,7,0,0,0,0,0,0,5,7,7,7,5,5,5,5,5,5,5,5,5,3,3,6,5,5,5,5,5,5,5,5,5,5,5,5,5,3,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,10,11,11,9,11,11,11,11,11,11,11,8,11,10,9,11,8,10,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	11,11,11,16,9,8,11,10,10,11,7,11,11,11,8,8,9,10,11,7,11,11,16,11,9,10,11,11,11,10,11,11,11,16,9,10,9,8,10,10,9,6,10,16,11,10,9,6,8,11,9,11,7,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,11,6,11,11,11,11,11,11,11,11,11,6,11,6,11,11,11,6,11,6,6,11,11,11,11,11,11,8,8,8,8,8,11,11,11,11,11,11,11,11,11,11,4,4,11,11,4,4,11,9,11,11,11,11,11,11,11,11,11,11,11,9,16,9,16,9,11,11,11,11,11,11,11,11,6,6,11,6,11,6,11,11,9,9,9,9,9,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	16,8,16,16,8,8,11,16,16,8,8,16,8,8,8,9,8,16,11,8,8,8,8,8,8,3,16,8,8,16,16,16,16,8,8,8,8,16,8,16,16,16,16,16,16,8,16,8,8,8,8,8,16,16,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,8,8,8,7,8,8,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,8,8,8,8,8,8,16,16,8,8,8,8,16,16,8,8,16,16,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16,16,8,8,16,16,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,10,7,7,9,9,16,7,7,7,7,7,7,7,7,10,7,16,7,7,7,7,7,16,7,7,7,7,7,7,7,11,11,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,16,7,7,7,7,7,7,7,7,7,7,7,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,
	16,16,16,16,11,11,11,11,11,11,11,11,16,11,11,16,16,11,11,16,16,11,11,16,16,11,11,16,16,16,11,11,16,11,11,16,16,16,11,11,16,11,11,16,16,11,11,16,16,11,11,16,16,11,11,16,16,11,11,16,16,11,11,16,11,11,16,11,11,11,11,11,11,11,11,16,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,7,7,7,7,7,7,7,7,7,7,16,16,8,8,8,8,8,8,8,8,4,4,11,8,8,8,8,8,16,16,8,8,8,8,8,8,7,8,16,16,8,8,8,8,8,8,7,8,16,16,8,8,8,16,8,8,16,16,8,8,8,8,8,8,8,8,7,7,8,8,8,8,8,8,8,8,8,8,8,8,4,8,8,8,8,8,8,8,8,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,16,16,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,9,9,9,8,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,11,11,10,11,10,11,11,11,16,6,16,11,11,16,6,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,16,16,16,16,7,16,16,16,16,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,16,7,16,16,16,16,7,7,7,16,7,16,16,16,16,16,16,16,7,7,16,16,16,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,9,9,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,10,10,9,9,9,7,8,8,7,7,5,9,8,6,7,10,10,4,9,8,9,7,7,9,6,6,8,9,6,7,3,9,3,7,5,10,10,7,3,8,10,10,8,5,9,8,7,9,8,6,10,5,10,7,7,7,7,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,11,9,9,8,8,8,7,7,7,8,7,7,9,9,8,11,14,7,9,8,9,7,8,7,7,7,7,7,7,7,7,7,8,10,10,8,10,8,8,7,7,7,7,8,7,7,7,7,10,10,10,10,10,10,10,7,14,14,14,13,16,13,14,7,7,7,7,8,7,7,7,7,6,8,9,6,8,6,6,7,8,10,10,8,10,8,8,7,5,7,6,7,6,7,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,7,7,16,7,16,16,16,7,16,16,16,16,7,7,7,7,7,7,7,16,7,16,7,7,7,7,16,16,7,7,7,7,7,7,7,16,7,16,7,7,16,7,16,7,16,7,7,7,7,16,7,7,16,16,7,7,7,16,16,7,16,7,7,7,7,7,7,7,16,7,7,7,16,7,16,16,7,16,7,7,7,7,7,7,16,16,7,7,7,7,7,7,16,7,7,7,7,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,
	11,11,11,16,16,16,16,16,8,8,8,8,8,8,8,8,8,8,16,16,8,8,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,0,0,0,0,0,0,16,16,16,16,16,16,16,16,7,7,7,16,16,16,16,7,7,12,15,13,15,10,11,12,14,13,15,16,16,14,14,9,13,15,16,13,14,12,14,12,12,15,16,16,16,15,15,15,15,14,14,13,15,15,14,14,12,14,14,15,16,16,16,16,16,16,15,15,15,16,16,16,16,16,16,16,16,16,14,16,16,16,13,14,16,14,16,12,14,13,12,14,16,14,14,16,16,16,14,15,13,13,13,7,7,0,0,8,8,12,11,16,16,12,14,10,13,12,15,12,14,13,15,13,15,15,15,13,15,15,15,13,14,16,16,14,14,14,15,15,16,13,14,12,15,15,15,12,14,15,14,15,10,11,15,15,13,15,11,16,16,16,12,14,14,13,14,14,15,15,15,15,15,15,14,11,16,12,14,13,16,13,15,10,12,13,12,16,14,14,12,15,16,16,13,14,15,12,12,15,15,15,15,8,15,12,12,16,
	7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,11,12,12,9,11,14,11,11,13,13,13,11,10,13,12,12,
	16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,
	16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7
	],
	//  13312-19893 = 16
	//  19894-19967 = 7 
	//  19968-40891 = 16
	//  40892-40959 = 7 
	//  40960-42124 = 11
	[
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	9,9,11,11,11,12,14,9,9,11,11,11,7,7,11,11,15,15,11,11,13,10,8,8,10,10,16,16,9,9,18,15,11,9,12,17,11,12,12,5,11,12,6,13,9,9,9,11,11,9,9,11,11,8,8,4,7,7,11,11,11,8,10,7,13,13,13,8,8,12,10,7,10,7,12,12,12,12,11,11,11,9,11,10,9,9,9,7,7,10,9,9,9,12,8,8,11,11,12,12,11,11,8,9,9,12,7,13,9,12,12,6,12,10,10,9,11,11,7,7,10,10,7,11,7,9,9,9,9,12,12,10,10,11,12,10,11,5,9,6,6,8,4,12,13,9,10,12,7,10,10,10,13,9,10,11,11,10,10,12,12,12,12,13,7,8,8,11,9,9,9,9,13,13,13,13,10,10,10,10,9,7,7,7,11,7,9,13,13,11,10,9,11,13,13,9,9,11,11,11,13,8,8,8,10,8,10,6,6,10,10,10,11,10,11,7,9,9,6,10,14,9,9,7,13,9,15,9,10,13,10,10,7,9,8,10,14,12,12,11,11,10,10,13,13,10,10,10,10,10,10,11,11,11,11,10,
	10,10,10,9,9,9,9,9,11,7,10,12,11,7,6,12,20,9,14,5,11,12,7,10,13,8,13,13,9,10,12,9,9,9,9,9,9,9,9,9,9,9,15,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,5,5,5,6,4,4,3,3,3,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,3,5,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,11,11,11,9,9,9,9,9,9,9,7,9,9,10,10,10,9,9,9,9,10,9,9,9,7,9,9,9,12,9,9,10,9,7,9,9,12,9,7,8,7,9,9,7,9,9,9,10,12,7,4,6,8,8,2,6
	],
	//  43128-44031 = 7 
	//  44032-55203 = 16
	//  55204-57343 = 7 
	//  57344-59243 = 8 
	[
	16,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16,16,16,16,16,16,16,16,16,16,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16,16,16,16,16,16,16,16,16,16,16,16,16,8,8,8,8,8,8,8,8,8,8,8,8,
	8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16
	],
	//  59493-63743 = 8 
	[
	16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,
	16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,8,8,9,11,10,11,10,10,11,9,11,7,11,11,11,11,9,9,9,9,6,9,9,4,6,7,9,4,8,8,8,7,9,7,5,10,7,9,9,7,8,9,8,11,10,4,9,8,9,10,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,7,7,7,
	7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,16,16,16,16,16,16,7,7,7,7,7,7,0,0,0,0,4,4,4,7,7,7,7,7,7,7,7,7,16,16,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,8,8,7,7,16,16,16,16,16,16,16,16,16,16,7,16,16,16,16,7,16,16,16,16,16,16,16,16,16,16,16,16,16,16,7,16,16,16,16,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,0,
	7,16,16,16,16,16,16,16,8,8,16,16,11,16,11,16,11,11,11,11,11,11,11,11,11,11,8,8,16,16,16,16,16,11,12,12,12,11,10,12,12,4,10,12,10,15,12,13,11,13,12,12,10,12,11,16,10,10,10,8,16,8,8,16,8,9,10,9,10,9,5,9,10,4,4,10,4,15,10,10,10,10,6,9,5,10,8,12,8,8,8,8,16,8,16,8,8,7,7,7,7,7,9,8,7,8,8,8,8,8,7,8,10,10,9,10,10,10,9,10,9,10,9,11,9,10,10,9,9,10,10,10,7,10,10,9,10,8,10,8,9,10,10,10,7,11,8,10,11,10,8,9,8,11,9,9,9,9,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,16,16,16,16,16,16,16,7,8,8,8,8,8,8,8,7,7,7,7,7,7,7,7,7,7,7,7,7,16,7,7
	]
];

var CHARREF_TABLE = {
	"&quot;" : "&#34;",
	"&amp;" : "&#38;",
	"&apos;" : "&#39;",
	"&lt;" : "&#60;",
	"&gt;" : "&#62;",
	"&nbsp;" : "&#160;",
	"&iexcl;" : "&#161;",
	"&cent;" : "&#162;",
	"&pound;" : "&#163;",
	"&curren;" : "&#164;",
	"&yen;" : "&#165;",
	"&brvbar;" : "&#166;",
	"&sect;" : "&#167;",
	"&uml;" : "&#168;",
	"&copy;" : "&#169;",
	"&ordf;" : "&#170;",
	"&laquo;" : "&#171;",
	"&not;" : "&#172;",
	"&shy;" : "&#173;",
	"&reg;" : "&#174;",
	"&macr;" : "&#175;",
	"&deg;" : "&#176;",
	"&plusmn;" : "&#177;",
	"&sup2;" : "&#178;",
	"&sup3;" : "&#179;",
	"&acute;" : "&#180;",
	"&micro;" : "&#181;",
	"&para;" : "&#182;",
	"&middot;" : "&#183;",
	"&cedil;" : "&#184;",
	"&sup1;" : "&#185;",
	"&ordm;" : "&#186;",
	"&raquo;" : "&#187;",
	"&frac14;" : "&#188;",
	"&frac12;" : "&#189;",
	"&frac34;" : "&#190;",
	"&iquest;" : "&#191;",
	"&Agrave;" : "&#192;",
	"&Aacute;" : "&#193;",
	"&Acirc;" : "&#194;",
	"&Atilde;" : "&#195;",
	"&Auml;" : "&#196;",
	"&Aring;" : "&#197;",
	"&AElig;" : "&#198;",
	"&Ccedil;" : "&#199;",
	"&Egrave;" : "&#200;",
	"&Eacute;" : "&#201;",
	"&Ecirc;" : "&#202;",
	"&Euml;" : "&#203;",
	"&Igrave;" : "&#204;",
	"&Iacute;" : "&#205;",
	"&Icirc;" : "&#206;",
	"&Iuml;" : "&#207;",
	"&ETH;" : "&#208;",
	"&Ntilde;" : "&#209;",
	"&Ograve;" : "&#210;",
	"&Oacute;" : "&#211;",
	"&Ocirc;" : "&#212;",
	"&Otilde;" : "&#213;",
	"&Ouml;" : "&#214;",
	"&times;" : "&#215;",
	"&Oslash;" : "&#216;",
	"&Ugrave;" : "&#217;",
	"&Uacute;" : "&#218;",
	"&Ucirc;" : "&#219;",
	"&Uuml;" : "&#220;",
	"&Yacute;" : "&#221;",
	"&THORN;" : "&#222;",
	"&szlig;" : "&#223;",
	"&agrave;" : "&#224;",
	"&aacute;" : "&#225;",
	"&acirc;" : "&#226;",
	"&atilde;" : "&#227;",
	"&auml;" : "&#228;",
	"&aring;" : "&#229;",
	"&aelig;" : "&#230;",
	"&ccedil;" : "&#231;",
	"&egrave;" : "&#232;",
	"&eacute;" : "&#233;",
	"&ecirc;" : "&#234;",
	"&euml;" : "&#235;",
	"&igrave;" : "&#236;",
	"&iacute;" : "&#237;",
	"&icirc;" : "&#238;",
	"&iuml;" : "&#239;",
	"&eth;" : "&#240;",
	"&ntilde;" : "&#241;",
	"&ograve;" : "&#242;",
	"&oacute;" : "&#243;",
	"&ocirc;" : "&#244;",
	"&otilde;" : "&#245;",
	"&ouml;" : "&#246;",
	"&divide;" : "&#247;",
	"&oslash;" : "&#248;",
	"&ugrave;" : "&#249;",
	"&uacute;" : "&#250;",
	"&ucirc;" : "&#251;",
	"&uuml;" : "&#252;",
	"&yacute;" : "&#253;",
	"&thorn;" : "&#254;",
	"&yuml;" : "&#255;",
	"&OElig;" : "&#338;",
	"&oelig;" : "&#339;",
	"&Scaron;" : "&#352;",
	"&scaron;" : "&#353;",
	"&Yuml;" : "&#376;",
	"&fnof;" : "&#402;",
	"&circ;" : "&#710;",
	"&tilde;" : "&#732;",
	"&Alpha;" : "&#913;",
	"&Beta;" : "&#914;",
	"&Gamma;" : "&#915;",
	"&Delta;" : "&#916;",
	"&Epsilon;" : "&#917;",
	"&Zeta;" : "&#918;",
	"&Eta;" : "&#919;",
	"&Theta;" : "&#920;",
	"&Iota;" : "&#921;",
	"&Kappa;" : "&#922;",
	"&Lambda;" : "&#923;",
	"&Mu;" : "&#924;",
	"&Nu;" : "&#925;",
	"&Xi;" : "&#926;",
	"&Omicron;" : "&#927;",
	"&Pi;" : "&#928;",
	"&Rho;" : "&#929;",
	"&Sigma;" : "&#931;",
	"&Tau;" : "&#932;",
	"&Upsilon;" : "&#933;",
	"&Phi;" : "&#934;",
	"&Chi;" : "&#935;",
	"&Psi;" : "&#936;",
	"&Omega;" : "&#937;",
	"&alpha;" : "&#945;",
	"&beta;" : "&#946;",
	"&gamma;" : "&#947;",
	"&delta;" : "&#948;",
	"&epsilon;" : "&#949;",
	"&zeta;" : "&#950;",
	"&eta;" : "&#951;",
	"&theta;" : "&#952;",
	"&iota;" : "&#953;",
	"&kappa;" : "&#954;",
	"&lambda;" : "&#955;",
	"&mu;" : "&#956;",
	"&nu;" : "&#957;",
	"&xi;" : "&#958;",
	"&omicron;" : "&#959;",
	"&pi;" : "&#960;",
	"&rho;" : "&#961;",
	"&sigmaf;" : "&#962;",
	"&sigma;" : "&#963;",
	"&tau;" : "&#964;",
	"&upsilon;" : "&#965;",
	"&phi;" : "&#966;",
	"&chi;" : "&#967;",
	"&psi;" : "&#968;",
	"&omega;" : "&#969;",
	"&thetasym;" : "&#977;",
	"&upsih;" : "&#978;",
	"&piv;" : "&#982;",
	"&ensp;" : "&#8194;",
	"&emsp;" : "&#8195;",
	"&thinsp;" : "&#8201;",
	"&zwnj;" : "&#8204;",
	"&zwj;" : "&#8205;",
	"&lrm;" : "&#8206;",
	"&rlm;" : "&#8207;",
	"&ndash;" : "&#8211;",
	"&mdash;" : "&#8212;",
	"&lsquo;" : "&#8216;",
	"&rsquo;" : "&#8217;",
	"&sbquo;" : "&#8218;",
	"&ldquo;" : "&#8220;",
	"&rdquo;" : "&#8221;",
	"&bdquo;" : "&#8222;",
	"&dagger;" : "&#8224;",
	"&Dagger;" : "&#8225;",
	"&bull;" : "&#8226;",
	"&hellip;" : "&#8230;",
	"&permil;" : "&#8240;",
	"&prime;" : "&#8242;",
	"&Prime;" : "&#8243;",
	"&lsaquo;" : "&#8249;",
	"&rsaquo;" : "&#8250;",
	"&oline;" : "&#8254;",
	"&frasl;" : "&#8260;",
	"&euro;" : "&#8364;",
	"&image;" : "&#8465;",
	"&weierp;" : "&#8472;",
	"&real;" : "&#8476;",
	"&trade;" : "&#8482;",
	"&alefsym;" : "&#8501;",
	"&larr;" : "&#8592;",
	"&uarr;" : "&#8593;",
	"&rarr;" : "&#8594;",
	"&darr;" : "&#8595;",
	"&harr;" : "&#8596;",
	"&crarr;" : "&#8629;",
	"&lArr;" : "&#8656;",
	"&uArr;" : "&#8657;",
	"&rArr;" : "&#8658;",
	"&dArr;" : "&#8659;",
	"&hArr;" : "&#8660;",
	"&forall;" : "&#8704;",
	"&part;" : "&#8706;",
	"&exist;" : "&#8707;",
	"&empty;" : "&#8709;",
	"&nabla;" : "&#8711;",
	"&isin;" : "&#8712;",
	"&notin;" : "&#8713;",
	"&ni;" : "&#8715;",
	"&prod;" : "&#8719;",
	"&sum;" : "&#8721;",
	"&minus;" : "&#8722;",
	"&lowast;" : "&#8727;",
	"&radic;" : "&#8730;",
	"&prop;" : "&#8733;",
	"&infin;" : "&#8734;",
	"&ang;" : "&#8736;",
	"&and;" : "&#8743;",
	"&or;" : "&#8744;",
	"&cap;" : "&#8745;",
	"&cup;" : "&#8746;",
	"&int;" : "&#8747;",
	"&there4;" : "&#8756;",
	"&sim;" : "&#8764;",
	"&cong;" : "&#8773;",
	"&asymp;" : "&#8776;",
	"&ne;" : "&#8800;",
	"&equiv;" : "&#8801;",
	"&le;" : "&#8804;",
	"&ge;" : "&#8805;",
	"&sub;" : "&#8834;",
	"&sup;" : "&#8835;",
	"&nsub;" : "&#8836;",
	"&sube;" : "&#8838;",
	"&supe;" : "&#8839;",
	"&oplus;" : "&#8853;",
	"&otimes;" : "&#8855;",
	"&perp;" : "&#8869;",
	"&sdot;" : "&#8901;",
	"&lceil;" : "&#8968;",
	"&rceil;" : "&#8969;",
	"&lfloor;" : "&#8970;",
	"&rfloor;" : "&#8971;",
	"&lang;" : "&#9001;",
	"&rang;" : "&#9002;",
	"&loz;" : "&#9674;",
	"&spades;" : "&#9824;",
	"&clubs;" : "&#9827;",
	"&hearts;" : "&#9829;",
	"&diams;" : "&#9830;"
};

var charRefRegex = RegExp('(&[^;]+;|.)', 'g');
var numRefRegex = RegExp('^&#([0-9]+);');
var hexRefRegex = RegExp('^&#X([0-9A-F]+);');
function UnicodeCharToDot(byteCode)
{
	var matches = [];
	if (typeof byteCode == 'string' || byteCode instanceof String) {
		if (byteCode.length > 1) {
			var tmp = parseInt(byteCode);		// '0xFFFF'
			if (tmp) {
				byteCode = tmp;
			} else {
				tmp = CHARREF_TABLE[byteCode];	// '&amp;'
				if (tmp != undefined) {
					byteCode = tmp;
				}
				byteCode = byteCode.toUpperCase();
				if (matches = byteCode.match(numRefRegex)) {	// '&#65535;'
					byteCode = parseInt(matches[1]);
				} else if (matches = byteCode.match(hexRefRegex)) {	// '&#xFFFF;'
					byteCode = parseInt(matches[1], 16);
				}
			}
		} else {
			byteCode = byteCode.charCodeAt(0);		// simple character
		}
	}
	if ((!byteCode) || (byteCode < 0 && byteCode > 65535)) { return 0; }
	if (byteCode < 13312) {
		return UNICODE_DOTS[0][byteCode];
	} else if (byteCode >= 42125 && byteCode < 43128) {
		return UNICODE_DOTS[1][byteCode - 42125];
	} else if (byteCode >= 59244 && byteCode < 59493) {
		return UNICODE_DOTS[2][byteCode - 59244];
	} else if (byteCode >= 63744) {
		return UNICODE_DOTS[3][byteCode - 63744];
	} else if ((byteCode >= 13312 && byteCode < 19894) ||
			(byteCode >= 19968 && byteCode < 40892) ||
			(byteCode >= 44032 && byteCode < 55204)) {
		return 16;
	} else if ((byteCode >= 19894 && byteCode < 19968) ||
			(byteCode >= 40892 && byteCode < 40960) ||
			(byteCode >= 43128 && byteCode < 44032) ||
			(byteCode >= 55204 && byteCode < 57344)) {
		return 7;
	} else if ((byteCode >= 40960 && byteCode < 42125)) {
		return 11;
	} else if ((byteCode >= 57344 && byteCode < 59244) ||
			(byteCode >= 59493 && byteCode < 63744)) {
		return 8;
	}
	return 0;
	//return UNICODE_DOTS[byteCode];
}
function UnicodeStrToDot(str)
{
	var dot = 0;
	var matches = [];
	while (matches = charRefRegex.exec(str)) {
		var s = matches[1];
		var n = UnicodeCharToDot(matches[1]);
		dot += n
	}
	return dot;
}

function CharToDot(c)
{
	var dot = 16;
	for (var i = 0; i < CHARDOTS.length; i++) {
		if (CHARDOTS[i].indexOf(c) != -1) { 
			dot = i;
			break;
		}
	}
	return dot;
}
function StrToDot(str)
{
	var dot = 0;
	for (var i = 0; i < str.length; i++) {
		dot += CharToDot(str.charAt(i));
	}
	return dot;
}
function StrToDotEx(str)
{
	var dot = 0;
	var matches = [];
	while (matches = charRefRegex.exec(str)) {
		var s = matches[1];
		if (s.length > 1) {
			dot += UnicodeCharToDot(s);
		} else {
			dot += CharToDot(s);
		}
	}
	return dot;
}

/* [flags]
   LEFT  : ゴミ(コンマなど)を左側に寄せる 
   RIGHT : ゴミ(コンマなど)を右側に寄せる
   HEAD  : 文頭の半角スペースをアンダー( _ )に置換する
   TAIL  : 文末の半角スペースをアンダー( _ )に置換する
*/
function makeSpace(dot, align)
{
	if (arguments.length > 2 && arguments[2] == true) {
		return makeSpaceRefUse(dot, align);
	}
	if (dot <= 0) { return ''; }
	var zenSpace = Math.floor(dot / 11);
	var amari = dot % 11;
	var ret = '';
	/* use character 「､._ 　」 */
	switch (amari) {
		case 10 : 
			// if (zenSpace <= 0) { ret = " _"; }
			if (zenSpace <= 0) { ret = ".. "; }
			else if (zenSpace == 1) { ret = " 　 "; }
			else if (zenSpace == 2) { ret = "　 　 "; }
			else {
				ret = "　 　 ";
				zenSpace -= 2;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 9 :
			ret = "...";
			while (zenSpace--) { ret += "　"; }
			break;
		case 8 :
			if (zenSpace <= 0) { ret = ". "; }
			else {
				ret = ". ";
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 7 :
			// if (zenSpace <= 0) { ret = "､"; }
			if (zenSpace <= 0) { ret = ". "; }
			/* ret = " _. "; */
			else if (zenSpace == 1) { ret = "......"; }
			else if (zenSpace == 2) { ret = "......　";  }
			else if (zenSpace == 3) { ret = "......　　"; }
			else {
				ret = ". 　 　 ";
				zenSpace -= 3;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 6 :
			ret = "..";
			while (zenSpace--) { ret += "　"; }
			break;
		case 5 :
			if (zenSpace <= 0) { ret = " "; }
			else if (zenSpace == 1) { ret = "　 "; }
			else {
				ret = "　 ";
				zenSpace -= 1;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 4 :
			// over + 1
			if (zenSpace <= 0) { ret = " ";/*ret = "ﾞ";*/ }
			// ret = " _ ";
			else if (zenSpace == 1) { ret = ".....";  }
			else if (zenSpace == 2) { ret = ".....　"; }
			else if (zenSpace == 3) { ret = ".....　　"; }
			else if (zenSpace == 4) { ret = ".....　　　"; }
			else {
				ret = "　 　 　 ";
				zenSpace -= 4;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 3 :
			ret = ".";
			while (zenSpace--) { ret += "　"; }
			break;
		case 2 :
			if (zenSpace <= 0) {
				// 不可能
				ret = ".";		// over +1
			} else if (zenSpace == 1) { ret = " . "; }
			else if (zenSpace == 2) { ret = " . 　"; }
			else {
				ret = ". 　 ";
				zenSpace -= 2;
				var testnum = 100;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 1 :
			if (zenSpace <= 0) {
				// 不可能
				ret = ".";		// over +2
			} else {
				ret = "....";
				zenSpace -= 1;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		default :
			while (zenSpace--) { ret += "　"; }
			break;
	}
	if ((align & RIGHT) > 0) {
		ret = ret.split('').reverse().join('');
	}
	if (((align & HEAD) > 0) && (ret.charAt(0) == ' ')) {
		//ret = '_' + ret.substring(1);
		ret = '..' + ret.substring(1);
	}
	if (((align & TAIL) > 0) && (ret.charAt(ret.length - 1) == ' ')) {
		//ret = ret.substring(0, ret.length - 1) + '_';
		ret = ret.substring(0, ret.length - 1) + '..';
	}
	return ret;
}

function makeSpaceRefUse(dot, align)
{
	if (dot <= 0) { return ''; }
	var zenSpace = Math.floor(dot / 11);
	var amari = dot % 11;
	var ret = '';
	switch (amari) {
		case 10 : 
			if (zenSpace <= 0) { ret = ' &#160;'; }
			else if (zenSpace == 1) { ret = ' 　 '; }
			else { 
				ret = '　 　 ';
				zenSpace -= 2;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 9 :
			if (zenSpace <= 0) { ret = " &#8197;"; }
			else { 
				ret = "　 &#8197;";
				zenSpace--;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 8 :
			if (zenSpace <= 0) { ret = " &#8198;"; }
			else { 
				ret = "　 &#8198;";
				zenSpace--;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 7 :
			if (zenSpace <= 0) { ret = " &#8201;"; }
			else { 
				ret = "　 &#8201;";
				zenSpace--;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 6 :
			if (zenSpace <= 0) { ret = " &#8202;"; }
			else { 
				ret = "　 &#8202;";
				zenSpace--;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 5 :
			if (zenSpace <= 0) { ret = " "; }
			else {
				ret = "　 ";
				zenSpace--;
				while (zenSpace--) { ret += "　"; }
			}
			break;
		case 4 :
			ret = '&#8197;';
			while (zenSpace--) { ret += "　"; }
			break;
		case 3 :
			ret = '&#8198;';
			while (zenSpace--) { ret += "　"; }
			break;
		case 2 :
			ret = '&#8201;';
			while (zenSpace--) { ret += "　"; }
			break;
		case 1 :
			ret = '&#8202;';
			while (zenSpace--) { ret += "　"; }
			break;
		default :
			while (zenSpace--) { ret += "　"; }
			break;
	}
	if (((align & HEAD) > 0) && (ret.charAt(0) == ' ')) {
		ret = '&#160;' + ret.substring(1);
	}
	if (((align & TAIL) > 0) && (ret.charAt(ret.length - 1) == ' ')) {
		ret = ret.substring(0, ret.length - 1) + '&#160;';
	}
	return ret;
}

var KeisenRule = {
	RuleName : 'KeisenRule',
	HCLen : 16,
	CCLen : 16,
	KCT : {
		"┌" : "┌",
		"┬" : "┬",
		"┐" : "┐",
		"─" : "─",
		"├" : "├",
		"┼" : "┼",
		"┤" : "┤",
		"│" : "│",
		"└" : "└",
		"┴" : "┴",
		"┘" : "┘",
		"┏" : "┏",
		"┳" : "┳",
		"┓" : "┓",
		"━" : "━",
		"┣" : "┣",
		"╋" : "╋",
		"┫" : "┫",
		"┃" : "┃",
		"┗" : "┗",
		"┻" : "┻",
		"┛" : "┛",
		"┠" : "┠",
		"╂" : "╂",
		"┨" : "┨",
		"┰" : "┰",
		"┸" : "┸",
		"┝" : "┝",
		"┿" : "┿",
		"┥" : "┥",
		"┯" : "┯",
		"┷" : "┷"
	},
	setKCT : function(StrOrArray) {
		// こんな感じの文字をセット '┌┬┐─├┼┤│└┴┘┏┳┓━┣╋┫┃┗┻┛┠╂┨┰┸┝┿┥┯┷';
		var i = 0;
		if (typeof StrOrArray == 'string' || StrOrArray instanceof String) {
			StrOrArray = StrOrArray.split('');
		}
		this.HCLen = StrToDotEx(StrOrArray[3]);
		this.CCLen = StrToDotEx(StrOrArray[0]);
		//if (DEBUG) {  // ユーザー指定罫線の為にあえてデバッグ出力を残したままにする
			for (var n in this.KCT) {
				put('\n　　【{0}】{1} → {2}', n, this.KCT[n], StrOrArray[i]);
				i++;
			}
			if (i != StrOrArray.length) { logFunc('setKCT', '　KCT要素数が一致しません。(KCT.length = {0}, StrOrArray.length = {1})', i, StrOrArray.length); }
			logFunc('setKCT', '　Rule : {0}のKCTを再定義しました。(水平罫線１個分のwidth={2}, 境界罫線１個分のwidth={3}){1}', this.RuleName, getStoreString(), this.HCLen, this.CCLen);
			i = 0;
		//}
		for (var n in this.KCT) {
			this.KCT[n] = StrOrArray[i++];
		}
	},
	DefineHorizontalLine : function(cell, hAlign, isBold) {
		var base = '';
		if (!cell.mergeLinks[hAlign]) {
			if (cell[hAlign]) {
				if (isBold) {
					base = this.KCT['━'];	/* ヘッダー隣接セルの上 */
				} else {
					base = this.KCT['─'];	/* 内枠でセルの上 */
				}
			} else {
				base = this.KCT['━'];	/* 外枠でセルの上 */
			}
		}
		return base;
	},
	DefineVerticalLine : function(cell, vAlign, isBold) {
		var base = '';
		if (!cell.mergeLinks[vAlign]) {
			if (cell[vAlign]) {
				if (isBold) {
					base = this.KCT['┃'];	/* 内枠でセルの左(区切り線) */
				} else {
					base = this.KCT['│'];	/* 内枠でセルの左(区切り線) */
				}
			} else {
				base = this.KCT['┃'];	/* 外枠左端のセルの左 */
			}
		}
		return base;
	},
	ReverseTable : [
		'┏┓┗┛','┌┐└┘',
		'┣┫','┠┨','┝┥','├┤',
		'┳┻','┯┷','┰┸','┬┴'
	],
	ReverseCornerString : function(text, hReverse, vReverse) {
		for (var i = 0; i < this.ReverseTable.length; i++) {
			var idx = this.ReverseTable[i].indexOf(text);
			if (idx >= 0) {
				if (i < 2) { return this.ReverseTable[i].charAt((vReverse << 1) + hReverse); }
				else if (i >= 2 && i < 6) {
					return this.ReverseTable[i].charAt(idx ^ hReverse);
				} else {
					return this.ReverseTable[i].charAt(idx ^ vReverse);
				}
			}
		}
		return text;
	},
	DefineCorner : function(cell, hAlign, vAlign, isBold) {
		var base = '';
		var hReverse = (hAlign == 'right')? 1 : 0;
		var vReverse = (vAlign == 'bottom')? 1 : 0;
		
		/* 左上用のみ定義してあとは反転させる */
		var str = [this.KCT['┿'], this.KCT['┼'], this.KCT['┯'], this.KCT['┣'], this.KCT['┠'], this.KCT['┏']];
		if (cell.mergeLinks[hAlign]) {
			if (cell.mergeLinks[vAlign]) {
				return '';
			} else if (cell[vAlign] && cell[vAlign].mergeLinks[hAlign]) {
				str.splice(0, 3, this.KCT['━'], this.KCT['─'], this.KCT['━']);
			} else {
				str.splice(0, 3, this.KCT['┷'], this.KCT['┴'], this.KCT['━']);
			}
		} else {
			if (cell.mergeLinks[vAlign]) {
				if (cell[hAlign] && cell[hAlign].mergeLinks[vAlign]) {
					str.splice(0, 5, this.KCT['│'], this.KCT['│'], this.KCT['┯'], this.KCT['┃'], this.KCT['┃']);
				} else {
					str.splice(0, 5, this.KCT['┥'], this.KCT['┤'], this.KCT['┯'], this.KCT['┃'], this.KCT['┃']);
				}
			} else if (cell[hAlign] && cell[hAlign].mergeLinks[vAlign]) {
				str.splice(0, 2, this.KCT['┝'], this.KCT['├']);
			} else if (cell[vAlign] && cell[vAlign].mergeLinks[hAlign]) {
				str.splice(0, 2, this.KCT['┯'], this.KCT['┬']);
			}
		}
		if (cell[hAlign]) {
			if (cell[vAlign]) {
				if (isBold) {
					base = str[0];	/* 内枠ヘッダー隣接のセルの左上 */
				} else {
					base = str[1];	/* 内枠でセルの左上 */
				}
			} else {
				base = str[2];	/* 外枠でセルの左上 */
			}
		} else {
			if (cell[vAlign]) {
				if (isBold) {
					base = str[3];	/* 外枠左端ヘッダー隣接のセルの左上 */
				} else {
					base = str[4];	/* 外枠左端のセルの左上 */
				}
			} else {
				base = str[5];		/* 外枠左上端の角 */
			}
		}
		return this.ReverseCornerString(base, hReverse, vReverse);
	},
	Top : function(cell) {
		return this.DefineHorizontalLine(cell, 'top', (cell.top && (cell.top.header || cell.footer || cell.top.nextline)));
	},
	Left : function(cell) {
		return this.DefineVerticalLine(cell, 'left', false);
	},
	Right : function(cell) {
		return this.DefineVerticalLine(cell, 'right', false);
	},
	Bottom : function(cell) {
		return this.DefineHorizontalLine(cell, 'bottom', (cell.bottom && (cell.header || cell.bottom.footer || cell.nextline)));
	},
	LeftTop : function(cell) {
		return this.DefineCorner(cell, 'left', 'top', (cell.top && (cell.top.header || cell.footer || cell.top.nextline)));
	},
	RightTop : function(cell) {
		return this.DefineCorner(cell, 'right', 'top', (cell.top && (cell.top.header || cell.footer || cell.top.nextline)));
	},
	LeftBottom : function(cell) {
		return this.DefineCorner(cell, 'left', 'bottom', (cell.bottom && (cell.header || cell.bottom.footer || cell.nextline)));
	},
	RightBottom : function(cell) {
		return this.DefineCorner(cell, 'right', 'bottom', (cell.bottom && (cell.header || cell.bottom.footer || cell.nextline)));
	},
	MergeMove : function(ltCell) {
		if (ltCell.mergeLinks.right || ltCell.mergeLinks.top ||  (!(ltCell.mergeLinks.left || ltCell.mergeLinks.bottom))) {
			if (DEBUG) {
				if (STOREMES.length > 0) {
					if (ltCell.mergeLinks.right) { put('　結合処理は右上のセルを基点にするのでスキップします。'); }
					else if (ltCell.mergeLinks.top) { put('　結合処理済み。'); }
					else { put('　なし。'); }
					logFunc('MergeMove', '{0}', getStoreString());
				}
			}
			return true;
		}
		var cell = ltCell;	// セル処理用
		var lines = 1;		// 結合後の行数
		var w = ltCell.getWidth();			// 結合後のセル幅
		var tmp = null;		// 汎用
		if (DEBUG) {
			var tmp = 0;
			do { tmp++; } while (cell = cell.mergeLinks.bottom);
			put('　[結合セル:(行数={0}×', tmp);
			tmp = 0;
			cell = ltCell;
			do { tmp++; } while (cell = cell.mergeLinks.left);
			put('列数={0})]', tmp);
			cell = ltCell;
		}
		if (ltCell.mergeLinks.left) {
			w = 0;
			while (cell = cell.mergeLinks.left) {
				w += cell.getWidth() + this.CCLen;
				cell.setWidth(0);
			}
			// 結合による列幅の再計算
			var max = 0;			// 基点セルの列の最大幅
			tmp = cell = ltCell;	// 基点セルの最上段のセル(ループ用)
			while (tmp.top) {
				tmp = tmp.top;
				if (tmp.getRawText().getTextDots() > max) 
					max = tmp.getRawText().getTextDots();
				if (tmp.isTextOnBorder) {
					if (tmp.keisenLinks.top.getTextDots() > max)
						max = tmp.keisenLinks.top.getTextDots();
				}
			}

			while (cell = cell.bottom) { 
				if (cell.getRawText().getTextDots() > max) 
					max = cell.getRawText().getTextDots();
				if (cell.isTextOnBorder) {
					if (cell.keisenLinks.top.getTextDots() > max)
						max = cell.keisenLinks.top.getTextDots();
				}
			}
			if (DEBUG) { put('[マックス幅 = {0}]', max); }
			if (ltCell.getTextDots() > max) {
				var num = Math.floor((ltCell.getTextDots() - max) / this.HCLen);
				var cbk = num * this.HCLen;
				var lbk = Math.floor(w / this.HCLen) * this.HCLen;
				if (cbk > lbk) { 
					cbk = lbk;
					num = Math.floor(lbk / this.HCLen);
				}

				if (DEBUG) { put('[結合による列幅の調整:width({0} → {1})、引かれる罫線文字数:{2}]', tmp.getWidth(), tmp.getWidth() - cbk, num); }
				cell = tmp;
				var n;
				do {
					if (cell.keisenLinks.top) {
						if (cell.isTextOnBorder) {
							cell.keisenLinks.top.setWidth(cell.keisenLinks.top.getWidth() - cbk);
						} else {
							n = cell.keisenLinks.top.getText();
							cell.keisenLinks.top.setText(n.substr(0, n.length - num));
						}
					}
					if (!cell.bottom) { break; }
					if (cell === ltCell) { continue; }
					cell.setWidth(cell.getWidth() - cbk);
				} while (cell = cell.bottom);
				if (cell && cell.keisenLinks.bottom) {
					if (!(cell.bottom && cell.bottom.isTextOnBorder)) {
						n = cell.keisenLinks.bottom.getText();
						cell.keisenLinks.bottom.setText(n.substr(0, n.length - num));
					}
				}
				w -= cbk;
			}
			w = ltCell.getWidth() + w;
			ltCell.setWidth(w);
			if (DEBUG) { put('[結合後のセル幅:width={0}]', w); }
		}
		if (DEBUG) { logFunc('MergeMove', '{0}', getStoreString()); }
		if (ltCell.mergeLinks.bottom) {
			cell = ltCell;
			while (cell = cell.mergeLinks.bottom) {
				lines += 2;
				//cell.keisenLinks.top.setText(makeSpace(w, LEFT, global.USE_UNICODE));
				cell.keisenLinks.top.setText('');
				cell.keisenLinks.top.setWidth(w);
				cell.setWidth(w);
				var tmp = cell;
				while (tmp.mergeLinks.left && tmp.left.mergeLinks.top) {
					tmp = tmp.left;
					tmp.setWidth(0);
				}
			}
			if (DEBUG) { logFunc('MergeMove', '　　　結合セルの罫線を空白に変更しました。'); }
			if (lines > 1) {
				if (DEBUG) { put('[lines:{0}]', lines); }
				var ins = (ltCell.getLength() > lines)? lines : ltCell.getLength();	//挿入行数
				//var el = ((lines + 1) >> 1) + (ins >> 1);		//最終行(lines単位) (ネガティブ:下の行に先に挿入する)
				var el = ((lines + 1) >> 1) + ((ins - 1) >> 1);		//最終行(lines単位) (ポジティブ:上の行に先に挿入する)
				var remove = (el - (ins - 1)) != 1;
				if (DEBUG) { 
					put('[範囲行:{0} → {1}]', el - (ins - 1), el);
					logFunc('MergeMove', '　　　{0}[挿入行数:{1}] 文字列の再配置。及び複数行の反映。', getStoreString(), ins);
				}

				for (var n = ins - 1; n >= 0; n--,el--) {
					var idx = el >> 1;
					cell = ltCell;
					if (DEBUG) { put('[line:{0}, idx:{1}, 上:{2}]', el, idx, (el%2==0)? 'yes' : 'no'); }
					while (idx--) { cell = cell.bottom; }
					if (DEBUG) { put('　セル({0}, {1})', cell.rowIndex, cell.columnIndex); }
					if (el % 2 == 0) {
						if (DEBUG) { put('の罫線行(上)に'); }
						ltCell.getRawText(n).copyTo(cell.keisenLinks.top);
						cell.isTextOnBorder = true;
					} else {
						if (DEBUG) { put('に'); }
						cell.setText(ltCell.getRawText(n).getPaddingText());
					}
					if (DEBUG) { logFunc('MergeMove', '　　　{0}基準セルの{1}行目の文字列(行数={2})を配置しました。', getStoreString(), n + 1, ltCell.getLength()); }
				}
				if (remove) {
					if (DEBUG) { logFunc('MergeMove', '　　　基準セルの1行目の文字列が再配置されたので。このセルの文字列を消しました。'); }
					ltCell.setText('');
				}
			}
		}
		if (DEBUG) {
			if (STOREMES.length > 0) {
				logFunc('MergeMove', '{0}', getStoreString());
			}
		}
		return true;
	},
	detectWidthCellsForBorder : function(cell, width) {
		if (!cell) { return -1; }
		do { if (!cell.top) { break; } } while (cell = cell.top);
		var tmp = cell;
		var overDots = 0;
		var hclen = StrToDotEx(this.Top(cell));
		do {
			tmp = cell;
			if (overDots) {
				width += overDots;
				overDots = 0;
			}
			for (; tmp; tmp = tmp.bottom) {
				tmp.setWidth(width);
				if (tmp.getOverDots()) {
					overDots = this.HCLen;
					break;
				}
			}
		} while(overDots > 0);
		return width;
	},
	renderStandard : function(cells, cwmax) {
		var t;
		var ret = '';
		for (var row = 0; row < cells.length; row++) {
			var tmpstr = '';
			t = cells[row][0];
			do {
				ret += t.keisenLinks.leftTop.getText() + t.keisenLinks.top.getPaddingText();
				tmpstr += t.keisenLinks.left.getText() + t.getPaddingText();
			} while (t = t.right);
			t = cells[row][cwmax.length - 1];
			ret += t.keisenLinks.rightTop.getText() + '\n' + tmpstr + t.keisenLinks.right.getText() + '\n';
		}
		t = cells[cells.length - 1][0];
		do {
			ret += t.keisenLinks.leftBottom.getText() + t.keisenLinks.bottom.getPaddingText();
		} while (t = t.right);
		t = cells[cells.length - 1][cwmax.length - 1];
		ret += t.keisenLinks.rightBottom.getText();
		return ret;
	},
	renderWithoutOutline : function(cells, cwmax) {
		var t;
		var ret = '';
		for (var row = 0; row < cells.length; row++) {
			var tmpstr = '';
			t = cells[row][0];
			do {
				if (t.top != null) {
					ret += (t.left == null)
						? t.keisenLinks.top.getPaddingText()
						: t.keisenLinks.leftTop.getText() + t.keisenLinks.top.getPaddingText();
				}
				tmpstr += (t.left == null)
					? t.getPaddingText()
					: t.keisenLinks.left.getText() + t.getPaddingText();
			} while (t = t.right);
			ret += '\n' + tmpstr + '\n';
		}
		return ret;
	},
	renderWithoutHorizon : function(cells, cwmax) {
		var t;
		var ret = '';
		for (var row = 0; row < cells.length; row++) {
			var tmpstr = '';
			t = cells[row][0];
			do {
				if ((!t.top) || t.top.header || t.top.nextline || t.footer) {
					ret += t.keisenLinks.leftTop.getText() + t.keisenLinks.top.getPaddingText();
				}
				tmpstr += t.keisenLinks.left.getText() + t.getPaddingText();
			} while (t = t.right);
			t = cells[row][cwmax.length - 1];
			if ((!t.top) || t.top.header || t.top.nextline || t.footer) {
				ret += t.keisenLinks.rightTop.getText() + '\n';
			}
			ret += tmpstr + t.keisenLinks.right.getText() + '\n';
		}
		t = cells[cells.length - 1][0];
		do {
			ret += t.keisenLinks.leftBottom.getText() + t.keisenLinks.bottom.getPaddingText();
		} while (t = t.right);
		t = cells[cells.length - 1][cwmax.length - 1];
		ret += t.keisenLinks.rightBottom.getText();
		return ret;
	}
};

function Padding()
{
	this._overDots = 0;
	this._text = '';
	this._width = 0;
	this._align = LEFT;
}
Padding.prototype = {
	getWidth : function() { return this._width; },
	getAlign : function() { return this._align; },
	setAlign : function(in_align) { this.setText(this.getWidth(), in_align); },
	setWidth : function(in_width) { this.setText(in_width, this.getAlign()); },
	getText : function() { return this._text; },
	setText : function(len, align) {
		if (len < 0) { len = 0; }
		this._align = align;
		this._text = makeSpace(len, align, global.USE_UNICODE);
		this._width = len;
		this._overDots = StrToDotEx(this._text) - len;
	},
	acceptOverDots : function() {
		this._width += this._overDots;
		this._overDots = 0;
	},
	getOverLength : function() { return this._overDots; }
};

function KeisenObject()
{
	this._text = '';
}
KeisenObject.prototype = {
	getText : function() { return this._text; },
	setText : function(in_text) { this._text = in_text; }
};
function RawText(text)
{
	this._text = '';
	this._dots = 0;
	this._paddingLeft = new Padding();
	this._paddingRight= new Padding();
	this.setText(text);
	this._align = LEFT;
}
RawText.prototype = {
	copyTo : function(destRawText) {
		destRawText.setText(this.getText());
		destRawText.getPaddingLeft().setText(this.getPaddingLeft().getWidth(), this.getPaddingLeft().getAlign());
		destRawText.getPaddingRight().setText(this.getPaddingRight().getWidth(), this.getPaddingRight().getAlign());
	},
	getText : function() { return this._text; },
	setText : function(in_text) { this._text = in_text; this._dots = StrToDotEx(this._text); },
	getPaddingLeft : function() { return this._paddingLeft; },
	getPaddingRight: function() { return this._paddingRight; },
	getOverDots : function() { return this._paddingLeft.getOverLength() + this._paddingRight.getOverLength(); },
	getTextDots : function() { return this._dots; },
	getWidth : function() { return this._paddingLeft.getWidth() + this.getTextDots() + this._paddingRight.getWidth(); },
	setWidth : function(in_width) { this.calcPadding(in_width, this._align); },
	getAlign : function() { return this._align; },
	setAlign : function(in_align) { this._align = align; this.calcPadding(this.getWidth(), in_align); },
	getPaddingText : function() { return this.getPaddingLeft().getText() + this.getText() + this.getPaddingRight().getText(); },
	calcPadding : function(val, align) {
		var len = val - this.getTextDots();
		if (this.getTextDots() == 0) {
			align = LEFT;
		} else {
			if ((align & (LEFT | CENTER)) > 0 && this.getText().charAt(this.getText().length - 1) == ' ') {
				this.getPaddingRight().setAlign(this.getPaddingRight().getAlign() | HEAD);
			}
			if ((align & (RIGHT | CENTER)) > 0 && this.getText().charAt(0) == ' ') {
				this.getPaddingLeft().setAlign(this.getPaddingLeft().getAlign() | TAIL);
			}
		}
		switch (align) {
			case LEFT :
				if (len <= 0) {
					val = this.getTextDots();
					this.getPaddingRight().setWidth(0);
				} else {
					this.getPaddingRight().setWidth(len);
				}
				break;
			case RIGHT :
				if (len <= 0) {
					val = this.getTextDots();
					this.getPaddingLeft().setWidth(0);
				} else {
					this.getPaddingLeft().setWidth(len);
				}
				break;
			case CENTER :
				if (len <= 0) { 
					val = this.getTextDots();
					
					this.getPaddingLeft().setWidth(0);
					this.getPaddingRight().setWidth(0);
				} else {
					var len2 = len >> 1
					this.getPaddingLeft().setWidth(len2);
					if ((len % 2) == 1) len2++;
					this.getPaddingRight().setWidth(len2);
				}
				break;
			default:
				break;
		}
		this._align = align;
		return val;
	}
};

function RawTextCollection()
{
	this._raws = [];
}
RawTextCollection.prototype = {
	setText : function(text, width, align) {
		this._raws = [];
		var tmp = text.split('&br;');
		for (var i = 0; i < tmp.length; i++) {
			this._raws.push(new RawText(tmp[i]));
		}
		return this.calcPadding(width, align);
	},
	getText : function() {
		var idx = 0;
		if (arguments[0] !== undefined) {
			idx = arguments[0];
		}
		if (idx >= this.getLength()) { return 'ERROR'; }
		return this._raws[idx];
	},
	getLength : function() {
		return this._raws.length;
	},
	setLeftAlign : function(val) {
		for (var i = 0; i < this.getLength(); i++) {
			this.getText(i).getPaddingLeft().setAlign(val);
		}
	},
	setRightAlign : function(val) {
		for (var i = 0; i < this.getLength(); i++) {
			this.getText(i).getPaddingRight().setAlign(val);
		}
	},
	getOverDots : function() {
		var nmax = 0;
		for (var i = 0; i < this.getLength(); i++) {
			if (this.getText(i).getOverDots() > nmax)
				nmax = this.getText(i).getOverDots();
		}
		return nmax;
	},
	getTextDots : function() {
		return this.getText(arguments[0]).getTextDots();
	},
	getPaddingText : function() {
		return this.getText(arguments[0]).getPaddingText();
	},
	calcPadding : function(width, align) {
		for (var i = 0; i < this.getLength(); i++) {
			var w = this.getText(i).calcPadding(width, align);
			if (w > width) {
				width = w;
				i = -1;
				continue;
			}
		}
		return width;
	}
};

function Cell(text)
{
	this._rawTextCollection = new RawTextCollection();
	this._width = 0;
	this._align = LEFT;
	this.nextline = false;
	this.header = false;
	this.footer = false;
	this.rowIndex = 0;		// 結合前のインデックス
	this.columnIndex = 0;	// 結合前のインデックス
	this.borderStyle = 0;	// 0～1 = なし、 2以降 = +---+ or ┼─┼ or ╋━╋
	this.isTextOnBorder = false;
	// リンクリスト
	this.left = null;
	this.right = null;
	this.top = null;
	this.bottom = null;
	this.mergeLinks = { left: null, right: null, top: null, bottom: null };
	this.keisenLinks = {
		leftTop: null, top: null, rightTop: null,
		left: null, right: null,
		leftBottom: null, bottom: null, rightBottom: null
	};
	this.setText(text);
}
Cell.prototype = {
	getRawText : function() { return this._rawTextCollection.getText(arguments[0]); },
	getText : function() { return this.getRawText(arguments[0]).getText(); },
	setText : function(val) { // rawText セッターはKeisenRule.MergeMove()時のみ使用すること(タイミングによってはoverdotsが出てレイアウト崩れるケースがある)
		this.setWidth(this._rawTextCollection.setText(val, this.getWidth(), this.getAlign()));
	},
	getLength : function() { return this._rawTextCollection.getLength(); },
	getOverDots : function() { return this._rawTextCollection.getOverDots(); },
	getTextDots : function() { return this._rawTextCollection.getTextDots(); },
	getWidth : function() { return this._width; },
	setWidth : function(val) {
		if (this.isTextOnBorder) {
			var n = this.keisenLinks.top.getWidth();
			if (n > val) {
				val = n;
			}
		}
		this._width = (this._width != val) ? this._rawTextCollection.calcPadding(val, this.getAlign()) : this._width;
	},
	getPaddingText : function() { return this.getRawText(arguments[0]).getPaddingText(); },
	getAlign : function() { return this._align; },
	setAlign : function(val) {
		this._align = val;
		if (this._align == CENTER || this._align == LEFT) {
			this._rawTextCollection.setRightAlign(((!this.right) && (this.borderStyle < 2))? RIGHT | TAIL : RIGHT);
		}
		if (this._align == CENTER || this._align == RIGHT) {
			this._rawTextCollection.setLeftAlign(((!this.left) && (this.borderStyle < 2))? LEFT | HEAD : LEFT);
			
		}
	},
	isMergeable : function() { return (this.left || this.top || this.right || this.bottom)? true : false; }
};

var tablemaker = {
	text : '',
	maxwidthColumn : [],
	// 実行メイン
	make : function(text, borderStyle) {
		this.text = text;
		this.maxwidthColumn = [];
		var ret = '';
		KeisenRule.RuleName = '';
		if (borderStyle >= 20) { 
			switch (borderStyle % 10) {
				case 0 : KeisenRule.RuleName = '(内枠のみ)'; break;
				case 2 : KeisenRule.RuleName = '(横線なし)'; break;
				default: break;
			}
		}
		put('[STYLE = {0}][[SEPARATOR = {1}][TAILCUT = {2}][PREVIEW = {3}][USE_UNICODE = {4}]', borderStyle, global.SEPARATOR, global.TAILCUT, global.PREVIEW, global.USE_UNICODE);
		switch (borderStyle) {
			case 1 :
				logFunc('make', '{0}[Rule = なし]  空白のみの表作成を開始します。', getStoreString());
				ret = this.makeSeparatorTable(global.SEPARATOR);
				break;
			case 2 :
				borderStyle = 21;
			case 20:
			case 21:
			case 22:
				KeisenRule.RuleName = 'KeisenRule(半角)' + KeisenRule.RuleName;
				logFunc('make', '{1}[Rule = {0}] 罫線を使用して表作成を開始します。', KeisenRule.RuleName, getStoreString());
				if (global.USE_UNICODE) {
					KeisenRule.setKCT(["+", "+", "+", "-", "+", "+", "+", "&#8201;|&#8201;", "+", "+", "+", "+", "+", "+", "-", "+", "+", "+", "&#8201;|&#8201;", "+", "+", "+", "+", "+", "+", "+", "+", "+", "+", "+", "+", "+"]);
				} else {
					KeisenRule.setKCT('|||-||||||||||-|||||||||||||||||');
					//KeisenRule.setKCT('***-**********-*****************');
				}
				ret = this.makeBorderTable(KeisenRule, borderStyle);
				break;
			case 3 :
				borderStyle = 31;
			case 30:
			case 31:
			case 32:
				KeisenRule.RuleName = 'KeisenRule(細)' + KeisenRule.RuleName;
				logFunc('make', '{1}[Rule = {0}] 罫線を使用して表作成を開始します。', KeisenRule.RuleName, getStoreString());
				KeisenRule.setKCT('┌┬┐─├┼┤│└┴┘┌┬┐─├┼┤│└┴┘├┼┤┬┴├┼┤┬┴');
				ret = this.makeBorderTable(KeisenRule, borderStyle);
				break;
			case 4 :
				borderStyle = 41;
			case 40:
			case 41:
			case 42:
				KeisenRule.RuleName = 'KeisenRule(複合)' + KeisenRule.RuleName;
				logFunc('make', '{1}[Rule = {0}(標準)] 罫線を使用して表作成を開始します。', KeisenRule.RuleName, getStoreString());
				ret = this.makeBorderTable(KeisenRule, borderStyle);
				break;
			case 5 :
				borderStyle = 51;
			case 50:
			case 51:
			case 52:
				KeisenRule.RuleName = 'KeisenRule(太)' + KeisenRule.RuleName;
				logFunc('make', '{1}[Rule = {0}] 罫線を使用して表作成を開始します。', KeisenRule.RuleName, getStoreString());
				KeisenRule.setKCT('┏┳┓━┣╋┫┃┗┻┛┏┳┓━┣╋┫┃┗┻┛┣╋┫┳┻┣╋┫┳┻');
				ret = this.makeBorderTable(KeisenRule, borderStyle);
				break;
			case 9:
				borderStyle = 91;
			case 90:
			case 91:
			case 92:
				KeisenRule.RuleName = 'KeisenRule(ユーザー指定)' + KeisenRule.RuleName;
				logFunc('make', '{1}[Rule = {0}] 罫線を使用して表作成を開始します。', KeisenRule.RuleName, getStoreString());
				var nk = global.USER_KEISEN.split('&br;');
				if (nk.length == 1) {
					nk = global.USER_KEISEN;
				}
				KeisenRule.setKCT(nk);
				ret = this.makeBorderTable(KeisenRule, borderStyle);
				break;
			case 0 :
			default :
				logFunc('make', '{0}[Rule = なし] 空白のみの表作成を開始します。', getStoreString());
				ret = this.makeSpaceTable(22);
				break;
		}
		return ret;
	},
	// 罫線を使用したテーブル
	makeBorderTable : function(rule, style) {
		var ret = '';
		var cells = this.convCells(this.text, style);
		var cwmax = [];
		var hclen = rule.HCLen;
		for (var i = 0; i < this.maxwidthColumn.length; i++) {
			cwmax.push(Math.floor((this.maxwidthColumn[i] + (hclen - 1)) / hclen) * hclen);	// 罫線が16dotなので16の倍数にする
		}
		if (DEBUG) { 
			if (!(cells && cells.length > 0 && cells[0] && cells[0].length > 0))
				logFunc('makeSpaceTable', '入力文字列からセルが作成できませんでした。\n----\n{0}\n----', this.text);
		}
		if (cells && cells.length > 0 && cells[0] && cells[0].length > 0) {
			// 文字ドット数の余剰分カラムサイズを補正する
			for (var col = 0; col < cwmax.length; col++) {
				cwmax[col] = rule.detectWidthCellsForBorder(cells[0][col], cwmax[col]);
				if (DEBUG) { put('[width={0}]', cwmax[col]); }
			}
			if (DEBUG) { logFunc('makeBorderTable', '{0}　列の最大幅を仮決定しました。結合時は変更する可能性があります。', getStoreString()); }
			// 罫線の作成
			for (var row = 0; row < cells.length; row++) {
				for (var col = 0; col < cwmax.length; col++) {
					var item = cells[row][col];
					item.keisenLinks.leftTop.setText(rule.LeftTop(item));
					item.keisenLinks.left.setText(rule.Left(item));
					var c = rule.Top(item);
					var t = cwmax[col];
					if (DEBUG) { put('　罫線リンク → ({4}, {5}) [左上="{1}"][上="{2}"×{3}][左="{0}"]', item.keisenLinks.left.getText(), item.keisenLinks.leftTop.getText(), c, Math.floor(t / hclen), row, col); }
					while (t > 0) { item.keisenLinks.top.setText(item.keisenLinks.top.getText() + c); t -= hclen; } 
					if (!item.right) {
						item.keisenLinks.rightTop.setText(rule.RightTop(item));
						item.keisenLinks.right.setText(rule.Right(item));
						if (DEBUG) { put('[右上="{0}"][右="{1}"]', item.keisenLinks.rightTop.getText(), item.keisenLinks.right.getText()); }
					}
					if (!item.bottom) {
						item.keisenLinks.leftBottom.setText(rule.LeftBottom(item));
						c = rule.Bottom(item);
						t = cwmax[col];
						if (DEBUG) { put('[下="{0}"×{1}]', c, Math.floor(t / hclen)); }
						while (t > 0) { item.keisenLinks.bottom.setText(item.keisenLinks.bottom.getText() + c); t -= hclen; }
						if (!item.right) {
							if (DEBUG) { put('[右下="{0}"]', item.keisenLinks.rightBottom.getText()); }
							item.keisenLinks.rightBottom.setText(rule.RightBottom(item));
						}
					}
					if (DEBUG) { logFunc('makeBorderTable', '{0}', getStoreString()); }
				}
			}
			if (DEBUG) { logFunc('makeBorderTable', '列幅に基いて罫線リンクに罫線文字列を仮生成しました。'); }
			// 罫線を結合する
			for (var row = 0; row < cells.length; row++) {
				for (var col = 0; col < cwmax.length; col++) {
						if (DEBUG) { put('　結合リンク → ({0}, {1})', row, col); }
						rule.MergeMove(cells[row][col]);
				}
			}
			if (DEBUG) { logFunc('makeBorderTable', '結合リンクに基いて罫線文字列を置換、及びセル文字列を移動しました。'); }
			// 描画
			if (style >= 20) {
				switch (style % 10) {
					case 2: 
						ret = rule.renderWithoutHorizon(cells, cwmax);
						break;
					case 0 :
						ret = rule.renderWithoutOutline(cells, cwmax);
						break;
					case 1 :
					default :
						ret = rule.renderStandard(cells, cwmax);
						break;
				}
			} else {
				if (DEBUG) { logFunc('makeBorderTable', 'Style指定が不正です。({0})', borderStyle); }
			}
			logFunc('makeBorderTable', '表文字列の変換処理が完了しました。');
		} 
		return ret;
	},
	
	// 区切り文字を使用したテーブル
	makeSeparatorTable : function(separator) {
		var ret = '';
		var cells = this.convCells(this.text, 1);

		var len = (this.maxwidthColumn.length - 1) * StrToDotEx(separator);
		if (DEBUG) { 
			if (!(cells && cells.length > 0 && cells[0] && cells[0].length > 0))
				logFunc('makeSpaceTable', '入力文字列からセルが作成できませんでした。\n----\n{0}\n----', this.text);
		}
		if (cells && cells.length > 0 && cells[0] && cells[0].length > 0) {
			for (var col = 0; col < cells[0].length; col++) {
				var tmp = this.detectWidthCells(cells, col, this.maxwidthColumn[col]);
				if (DEBUG) { put('[width={0}]', tmp); }
				len += tmp;
			}
			if (DEBUG) { logFunc('makeSeparatorTable', '{0}　列の最大幅を決定しました。', getStoreString()); }
			if (global.TAILCUT) {
				var endidx = cells[0].length - 1;
				for (var row = 0; row < cells.length; row++) {
					if (DEBUG) { put('[({1},{2})_PaddingR: {0}', cells[row][endidx].getRawText().getPaddingRight().getWidth(), row, endidx); }
					cells[row][endidx].getRawText().getPaddingRight().setWidth(0);
					if (DEBUG) { put(' → {0}]', cells[row][endidx].getRawText().getPaddingRight().getWidth()); }
				}
				if (DEBUG) { logFunc('makeSeparatorTable', '{0}　$TAILCUT指定なので各行の末尾の空白を削除しました。', getStoreString()); }
			}
			for (var row = 0; row < cells.length; row++) {
				if (cells[row][0].footer) {
					ret += this.getNextLineString(len) + '\n';
				}
				for (var col = 0; col < cells[row].length; col++) {
					if (col != 0) ret += separator;
					ret += cells[row][col].getPaddingText();
				}
				ret += '\n';
				if (cells[row][0].nextline || cells[row][0].header) {
					ret += this.getNextLineString(len) + '\n';
				}
			}
			ret = ret.substr(0, ret.length - 1);	// 最終行の改行コード削除
			logFunc('makeSeparatorTable', '表文字列の変換処理が完了しました。');
		} 
		return ret;
	},
	// 空白のみのコンパクトなテーブル
	makeSpaceTable : function(margin) {
		var ret = '';
		var cells = this.convCells(this.text, 0);
		var cwmax = [];
		var len = 0;
		for (var i = 0; i < this.maxwidthColumn.length; i++) {
			cwmax.push(this.maxwidthColumn[i] + margin);		// marginのdot数分カラム幅を余裕を持たせる
		}
		if (DEBUG) { 
			if (!(cells && cells.length > 0 && cells[0] && cells[0].length > 0))
				logFunc('makeSpaceTable', '入力文字列からセルが作成できませんでした。\n----\n{0}\n----', this.text);
		}
		if (cells && cells.length > 0 && cells[0] && cells[0].length > 0) {
			for (var col = 0; col < cells[0].length; col++) {
				var tmp = this.detectWidthCells(cells, col, cwmax[col]);
				if (DEBUG) { put('[width={0}]', tmp); }
				len += tmp;
			}
			if (DEBUG) { logFunc('makeSpaceTable', '{0}　列の最大幅を決定しました。', getStoreString()); }
			// 各セルの向かい合ったPaddingを結合してゴミを出にくくする
			for (var row = 0; row < cells.length; row++) {
				for (var col = 0; col < cells[row].length; col++) {
					var item = cells[row][col];
					if (DEBUG) { put('['); }
					if (item.left && item.getRawText().getPaddingLeft().getWidth() > 0 && item.left.getRawText().getPaddingRight().getWidth() > 0) {
						if (DEBUG) { put('←のPaddingR({0})とPaddingL({1})を結合:', item.left.getRawText().getPaddingRight().getWidth(), item.getRawText().getPaddingLeft().getWidth()); }
						item.getRawText().getPaddingLeft().setWidth(item.getRawText().getPaddingLeft().getWidth() + item.left.getRawText().getPaddingRight().getWidth());
						item.left.getRawText().getPaddingRight().setWidth(0);
						if (DEBUG) { put('{0}', item.getRawText().getPaddingLeft().getWidth()); }
					}
					if (global.TAILCUT && (!item.right)) {
						item.getRawText().getPaddingRight().setWidth(0);
						if (DEBUG) { put('$TAILCUTの為末尾を削除 PaddingR: {0}', item.getRawText().getPaddingRight().getWidth()); }
					}
					if (DEBUG) { put('_]'); }
				}
				if (DEBUG) { logFunc('makeSpaceTable', 'Paddingの最適化 → {0}', getStoreString()); }
			}
			// 描画
			for (var row = 0; row < cells.length; row++) {
				if (cells[row][0].footer) {
					ret += this.getNextLineString(len) + '\n';
				}
				for (var col = 0; col < cells[row].length; col++) {
					ret += cells[row][col].getPaddingText();
				}
				ret += '\n';
				if (cells[row][0].nextline || cells[row][0].header) {
					ret += this.getNextLineString(len) + '\n';
				}
			}
			ret = ret.substr(0, ret.length - 1);	// 最終行の改行コード削除
			logFunc('makeSpaceTable', '表文字列の変換処理が完了しました。');
		} 

		return ret;
	},
	getNextLineString : function(width) {
		var ret = '';
		width = (width + 15) >> 4;
		while (width-- > 0) { ret += '―'; }
		return ret;
	},
	detectWidthCells : function(cells, columnIndex, width)
	{
		if (cells && cells.length > 0 && cells[0] && cells[0].length > columnIndex) {
			var overDots = 0;
			do {
				if (overDots) {
					width += overDots;
					overDots = 0;
				}
				for (var row = 0; row < cells.length; row++) {
					var item = cells[row][columnIndex];
					item.setWidth(width);
					if (overDots < item.getOverDots()) { 
						overDots = item.getOverDots();
					}
				}
			} while(overDots > 0);
			return width;
		}
		return -1;
	},
	convCells : function(text, borderStyle) {
		var matches = [];
		var rows = [];
		var lnArray = text.split('\n');
		for (var i = 0; i < lnArray.length; i++) {
			if (lnArray[i].length == 0) {
				lnArray.splice(i--, 1);
			}
		}
		var colNum = lnArray[0].split('|').length - 2;
		if (DEBUG) { logFunc('convCells', '[行数 = {1}][列数 = {0}] 入力文字列から行列数を取得しました。', colNum, lnArray.length); }
		var aligns = new Array(colNum);
		this.maxwidthColumn = new Array(colNum);
		for (var i = 0; i < colNum; i++) {
			aligns[i] = LEFT;
			this.maxwidthColumn[i] = 0;
		}
		
		for (var i = 0; i < lnArray.length; i++) {
			var items = lnArray[i].split('|');
			var style = items[items.length - 1];
			var header = false;
			var footer = false;
			var nextline = false;
			if (DEBUG) {
				if (!(style.length > 0)) { put('通常行 → '); }
			}
			if (style.length > 0) {
				if (matches = style.match(/(h|f|b)/i)) {
					switch (matches[1]) {
						case 'h' : 
							header = true;
							if (DEBUG) { put('ヘッダー行 → '); }
							break;
						case 'f' :
							footer = true;
							if (DEBUG) { put('フッター行 → '); }
							break;
						case 'b' :
							nextline = true;
							if (DEBUG) { put('通常行(+<BR>) → '); }
							break;
						default :
							break;
					}
				} else {
					if (style.match(/c/i)) {
						if (DEBUG) { put('　'); }
						for (var j = 1; j < items.length - 1; j++) {
							if (DEBUG) { put('['); }
							if (items[j].match(/LEFT/i)) { 
								aligns[j - 1] = LEFT;
								if (DEBUG) { put('左'); }
							} else if (items[j].match(/CENTER/i)) {
								aligns[j - 1] = CENTER;
								if (DEBUG) { put('中'); }
							} else if (items[j].match(/RIGHT/i)) {
								aligns[j - 1] = RIGHT;
								if (DEBUG) { put('右'); }
							}
							if (DEBUG) { put('_]'); }
						}
						if (DEBUG) { logFunc('convCells', '　スタイル指定行 → {0}', getStoreString()); }
						lnArray.splice(i--, 1);
						if (DEBUG) { logFunc('convCells', '[行数 = {1}][列数 = {0}] スタイル指定行を削除して行列数を変更しました。', colNum, lnArray.length); }
						continue;
					}
				}
			} 

			items.splice(0, 1);
			items.splice(items.length - 1, 1);

			var row = [];
			var hmergePrev = false;
			var nlCnt = 0;
			for (var j = 0; j < items.length; j++) {
				if (DEBUG) { put('['); }
				var hmerge = false;
				var vmerge = false;
				var ma = aligns[j];
				var str = items[j];
				if (str.match(/^LEFT:/i)) {
					ma = LEFT;
					if (DEBUG) { put('左:'); }
					str = str.substring(5);
				} else if (str.match(/^CENTER:/i)) {
					ma = CENTER;
					if (DEBUG) { put('中:'); }
					str = str.substring(7);
				} else if (str.match(/^RIGHT:/i)) {
					ma = RIGHT;
					if (DEBUG) { put('右:'); }
					str = str.substring(6);
				}
				if (str == '>') {
					if (borderStyle >= 2) hmerge = true;
					str = '';
				}
				if (str.charAt(0) == '~') {
					if (str.length == 1) {
						if (borderStyle >= 2) vmerge = true;
						str = '';
					} else {
						nlCnt++;
						str = str.substring(1);
					}
				}
				str = str.replace(/[ ]+/g, ' ').replace(/\\([>~])/, '$1');
				
				var cell = new Cell(str);

				if (cell.getTextDots() > this.maxwidth) {
					this.maxwidth = cell.getTextDots();
				}
				if (cell.getTextDots() > this.maxwidthColumn[j]) {
					this.maxwidthColumn[j] = cell.getTextDots();
				}
				cell.rowIndex = i;
				cell.columnIndex = j;
				cell.borderStyle = borderStyle;
				cell.setAlign(ma);
				cell.header = header;
				cell.footer = footer;
				if (!(header || footer)) {
					cell.nextline = nextline;
				}
				if (j > 0) {
					cell.left = row[j - 1];
					row[j - 1].right = cell;
					if (row[j - 1].keisenLinks.right) {
						cell.keisenLinks.left = row[j - 1].keisenLinks.right;
					} else {
						cell.keisenLinks.left = row[j - 1].keisenLinks.right = new KeisenObject();
					}
					if (row[j - 1].keisenLinks.rightTop) {
						cell.keisenLinks.leftTop = row[j - 1].keisenLinks.rightTop;
					} else {
						cell.keisenLinks.leftTop = row[j - 1].keisenLinks.rightTop = new KeisenObject();
					}
					if (row[j - 1].keisenLinks.rightBottom) {
						cell.keisenLinks.leftBottom = row[j - 1].keisenLinks.rightBottom;
					} else {
						cell.keisenLinks.leftBottom = row[j - 1].keisenLinks.rightBottom = new KeisenObject();
					}
					
				}
				if (i > 0) {
					cell.top = rows[i - 1][j];
					rows[i - 1][j].bottom = cell;
					if (rows[i - 1][j].keisenLinks.leftBottom) {
						cell.keisenLinks.leftTop = rows[i - 1][j].keisenLinks.leftBottom;
					} else {
						cell.keisenLinks.leftTop = rows[i - 1][j].keisenLinks.leftBottom = new KeisenObject();
					}
					if (rows[i - 1][j].keisenLinks.bottom) {
						cell.keisenLinks.top = rows[i - 1][j].keisenLinks.bottom;
					} else {
						cell.keisenLinks.top = rows[i - 1][j].keisenLinks.bottom = new RawText('');
					}
					if (rows[i - 1][j].keisenLinks.rightBottom) {
						cell.keisenLinks.rightTop = rows[i - 1][j].keisenLinks.rightBottom;
					} else {
						cell.keisenLinks.rightTop = rows[i - 1][j].keisenLinks.rightBottom = new KeisenObject();
					}
				}
				if (!cell.left) {
					cell.keisenLinks.left = new KeisenObject();
					cell.keisenLinks.leftBottom = new KeisenObject();
					cell.keisenLinks.leftTop = (cell.top)? cell.top.keisenLinks.leftBottom : new KeisenObject();
				}
				if (!cell.top) {
					cell.keisenLinks.top = new RawText('');
					cell.keisenLinks.rightTop = new KeisenObject();
					cell.keisenLinks.leftTop = (cell.left)? cell.left.keisenLinks.rightTop : new KeisenObject();
				}
				if (j == (items.length - 1)) {
					cell.keisenLinks.rightTop = (cell.top)? cell.top.keisenLinks.rightBottom : new KeisenObject();
					cell.keisenLinks.right = new KeisenObject();
					cell.keisenLinks.rightBottom = new KeisenObject();
				}
				if (i == (lnArray.length - 1)) {
					cell.keisenLinks.bottom = new RawText('');
					cell.keisenLinks.rightBottom = new KeisenObject();
					cell.keisenLinks.leftBottom = (cell.left)? cell.left.keisenLinks.rightBottom : new KeisenObject();
				}
				if (vmerge) {
					cell.mergeLinks.top = cell.top;
					cell.top.mergeLinks.bottom = cell;
					if (DEBUG) { put('↑と結合:'); }
					vmerge = false;
					if (cell.left && cell.left.mergeLinks.top) {
						var tmp = cell;
						while (tmp = tmp.mergeLinks.top) { if (!tmp.mergeLinks.top) { break; } }
						if (tmp.mergeLinks.left) {
							if (DEBUG) { put('←と結合:'); }
							cell.mergeLinks.left = cell.left;
							cell.left.mergeLinks.right = cell;
						}
					}
				}
				if (hmergePrev) {
					cell.mergeLinks.left = cell.left;
					cell.left.mergeLinks.right = cell;
					if (DEBUG) { put('←と結合:'); }
					hmergePrev = false;
				}
				if (hmerge) {
					hmergePrev = true;
				}
				if (DEBUG) { put('width={1}_{0}]', cell.getText(), cell.getRawText().getWidth()); }
				row.push(cell);
			}
			if (DEBUG) { logFunc('convCells', '　{0}', getStoreString()); }
			if (nlCnt == row.length) {
				if (DEBUG) { logFunc('convCells', '　　　文頭"~"が全てのセルにあったのでnextline属性を付けます。単一セルの「~」は対応する罫線文字が存在しないのでできません。'); }
				for (var n = 0; n < row.length; n++) {
					if (!(header || footer)) {
						row[n].nextline = true;
					}
				}
			}
			rows.push(row);
		}
		if (DEBUG) { logFunc('convCells', '文字列からCellに変換できました。'); }
		return rows;
	}
};

this.Convert = function(style) {
	var wp, tc, seltext = '', alltext = '';
	if (JANEVIEW) {
		wp = JaneScript.WriteForm;
		wp.PageIndex = 0;
		tc = wp.MsgBody;
		if (tc.Text && tc.Text.length > 0) {
			alltext = String(tc.Text).replace(/\r\n/g, '\n');
			if ((!tc.SelText) || tc.SelText.length == 0) {
				seltext = alltext;
			} else {
				seltext = String(tc.SelText).replace(/\r\n/g, '\n');
			}
		}
	} else {
		if (v2c.context) {
			wp = v2c.context.thread.openWritePanel();
		} else {
			wp = v2c.resPane.selectedThread.openWritePanel();
		}
		tc = wp.message;
		if (tc.text && tc.text.length() > 0) {
			alltext = String(tc.text);
			if ((!tc.selText) || tc.selText.length() == 0) {
				seltext = alltext;
			} else {
				seltext = String(tc.selText);
			}
		}
	}
	if (seltext.length == 0) { log('文字列が書き込み欄に入力されていないので変換できませんでした。。'); return false; }
	var selTextArray = seltext.split('\n');
	var converted = [];
	var n = [];
	for (var i = 0; i < selTextArray.length; i++) {
		if (/^\|.*\|[hbf]?$/i.test(selTextArray[i])) {
			n.push(selTextArray[i]);
			continue;
		} else if (n.length > 0) {
			var src = n.join('\n');
			var tmp = tablemaker.make(src, style);
			if (tmp) { converted.push(tmp); }
			else { converted.push(src); }
			n = [];
		}
		converted.push(selTextArray[i]);
	}
	if (n.length > 0) {
		var tmp = tablemaker.make(n.join('\n'), style);
		if (tmp) { converted.push(tmp); }
	}
	if (converted.length > 0) {
		var tmp = converted.join('\n');
		var other = alltext.split(seltext);
		var ss = other[0];
		var es = other[1];
		if (ss > 0 && ss[ss.length - 1] != '\n') { ss += '\n'; }
		if (es > 0 && es[0] != '\n') { es = '\n' + es; }
		if (JANEVIEW) {
			tc.Text = (ss + tmp + es).replace(/\n/g, '\r\n');
			if (global.PREVIEW) { wp.PageIndex = 1; }
		} else {
			tc.text = (ss + tmp + es);
			if (global.PREVIEW) { wp.preview = true; }
		}
	}
};

if (JANEVIEW) {
	var JaneViewMenu = {
		prefix : 'TableMakerOn',
		initialized : false,
		menuItem : [],				// メニュー項目
		ini: JaneScript.GetScriptConfig(),
		createMenuItem : function(parent, caption, gestureShortName, checkValue, func) {
			return JaneViewMenu._addMenuItem(parent, caption, gestureShortName, checkValue, func);
		},
		addMenuItem : function(parent, caption, gestureShortName, checkValue, func) {
			JaneViewMenu._addMenuItem(parent, caption, gestureShortName, checkValue, func);
		},
		_addMenuItem : function(parent, caption, gestureShortName, checkValue, func) {
			if (checkValue === null) {
				checkValue = undefined;
			}
			if (func === null) {
				func = undefined;
			}
			var mc = null;
			if (parent) {
				mc = parent.Add();
			} else {
				mc = JaneScript.InsertMenu('WriteForm.Menu', '', '');
			}
			mc.Caption = caption;
			mc.Checked = checkValue;
			if (gestureShortName) {
				mc.GestureName = JaneViewMenu.prefix + gestureShortName;
			}
			mc.OnClick = func;
			JaneViewMenu.menuItem.push(mc);
			return mc;
		},
		init : function() {
			if (JaneViewMenu.initialized) { return ; }
			var root = JaneViewMenu.createMenuItem(null, 'テーブルメイカー', 'Root', null, null);
			JaneViewMenu.addMenuItem(root, '選択範囲を表に変換する', 'Convert', null, function(o, t) {
				global.Convert(global.STYLE);
			});
			var styles = JaneViewMenu.createMenuItem(root, 'スタイルを選択して変換', 'SelConv', null, null);
			JaneViewMenu.addMenuItem(styles, '位置揃えのみ', 'ConvStyle0', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '区切り文字', 'ConvStyle1', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '-', null, null, null);
			JaneViewMenu.addMenuItem(styles, '半角文字の罫線', 'ConvStyle21', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '細い罫線', 'ConvStyle31', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, 'ヘッダー行が太い罫線', 'ConvStyle41', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '太い罫線', 'ConvStyle51', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, 'ユーザー指定罫線', 'ConvStyle91', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '-', null, null, null);
			JaneViewMenu.addMenuItem(styles, '半角文字の罫線（内枠のみ）', 'ConvStyle20', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '細い罫線（内枠のみ）', 'ConvStyle30', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, 'ヘッダー行が太い罫線（内枠のみ）', 'ConvStyle40', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '太い罫線（内枠のみ）', 'ConvStyle50', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, 'ユーザー指定罫線（内枠のみ）', 'ConvStyle90', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '-', null, null, null);
			JaneViewMenu.addMenuItem(styles, '半角文字の罫線（横線なし）', 'ConvStyle22', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '細い罫線（横線なし）', 'ConvStyle32', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, 'ヘッダー行が太い罫線（横線なし）', 'ConvStyle42', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, '太い罫線（横線なし）', 'ConvStyle52', null, JaneViewMenu.selectedConvert);
			JaneViewMenu.addMenuItem(styles, 'ユーザー指定罫線（横線なし）', 'ConvStyle92', null, JaneViewMenu.selectedConvert);
			
			JaneViewMenu.addMenuItem(root, '-', null, null, null);
			
			//var settings = JaneViewMenu.createMenuItem(root, '変換設定', 'Settings',  null, null);
			global.USE_UNICODE = (JaneViewMenu.ini.Read('General', 'USE_UNICODE', global.USE_UNICODE.toString()) == 'true');
			JaneViewMenu.addMenuItem(root, 'ユニコード空白文字を使用する', 'UseUnicode', global.USE_UNICODE, function(o, t) {
				global.USE_UNICODE = o['Checked'] = !global.USE_UNICODE;
				JaneViewMenu.ini.Write('General', 'USE_UNICODE', String(global.USE_UNICODE));
				JaneViewMenu.ini.UpdateFile();
			});
			global.SEPARATOR = JaneViewMenu.ini.Read('General', 'SEPARATOR', global.SEPARATOR);
			JaneViewMenu.addMenuItem(root, '区切り文字列を変更する', 'Separator', null, function(o, t) {
				var nv = JaneScript.InputBox('区切り文字列を変更する', global.SEPARATOR);
				if (!nv.Canceled) {
					global.SEPARATOR = nv.Text;
					JaneViewMenu.ini.Write('General', 'SEPARATOR', global.SEPARATOR);
					JaneViewMenu.ini.UpdateFile();
				}
			});
			global.USER_KEISEN = JaneViewMenu.ini.Read('General', 'USER_KEISEN', global.USER_KEISEN);
			JaneViewMenu.addMenuItem(root, 'ユーザー指定の罫線を変更する', 'UserKeisen', null, function(o, t) {
				var nv = JaneScript.InputBox('ユーザー指定罫線の設定「&br;」で区切って罫線種類を書き換えて下さい。詳細は同封のtablemaker-readme.txtに', global.USER_KEISEN);
				if (!nv.Canceled) {
					global.USER_KEISEN = nv.Text;
					JaneViewMenu.ini.Write('General', 'USER_KEISEN', global.USER_KEISEN);
					JaneViewMenu.ini.UpdateFile();
				}
			});
			global.TAILCUT = (JaneViewMenu.ini.Read('General', 'TAILCUT', global.TAILCUT.toString()) == 'true');
			JaneViewMenu.addMenuItem(root, '行の末尾を揃える', 'TailCut', !global.TAILCUT, function(o, t) {
				o['Checked'] = global.TAILCUT;
				global.TAILCUT = !global.TAILCUT;
				JaneViewMenu.ini.Write('General', 'TAILCUT', String(global.TAILCUT));
				JaneViewMenu.ini.UpdateFile();
			});
			global.PREVIEW = (JaneViewMenu.ini.Read('General', 'PREVIEW', global.PREVIEW.toString()) == 'true');
			JaneViewMenu.addMenuItem(root, '変換後にプレビューする', 'Preview', global.PREVIEW, function(o, t) {
				global.PREVIEW = o['Checked'] = !global.PREVIEW;
				JaneViewMenu.ini.Write('General', 'PREVIEW', String(global.PREVIEW));
				JaneViewMenu.ini.UpdateFile();
			});
			
			global.STYLE = parseInt(JaneViewMenu.ini.Read('General', 'STYLE', global.STYLE.toString()));
			var defstyles = JaneViewMenu.createMenuItem(root, '既定のスタイルの選択', 'StyleSelect', null, null);
			JaneViewMenu.addMenuItem(defstyles, '位置揃えのみ', 'fStyle0', (global.STYLE == 0), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '区切り文字', 'fStyle1', (global.STYLE == 1), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '-', null, null, null);
			JaneViewMenu.addMenuItem(defstyles, '半角文字の罫線', 'fStyle21', (global.STYLE == 21), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '細い罫線', 'fStyle31', (global.STYLE == 31), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, 'ヘッダー行が太い罫線', 'fStyle41', (global.STYLE == 41), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '太い罫線', 'fStyle51', (global.STYLE == 51), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, 'ユーザー指定罫線', 'fStyle91', (global.STYLE == 91), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '-', null, null, null);
			JaneViewMenu.addMenuItem(defstyles, '半角文字の罫線（内枠のみ）', 'fStyle20', (global.STYLE == 20), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '細い罫線（内枠のみ）', 'fStyle30', (global.STYLE == 30), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, 'ヘッダー行が太い罫線（内枠のみ）', 'fStyle40', (global.STYLE == 40), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '太い罫線（内枠のみ）', 'fStyle50', (global.STYLE == 50), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, 'ユーザー指定罫線（内枠のみ）', 'fStyle90', (global.STYLE == 90), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '-', null, null, null);
			JaneViewMenu.addMenuItem(defstyles, '半角文字の罫線（横線なし）', 'fStyle22', (global.STYLE == 22), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '細い罫線（横線なし）', 'fStyle32', (global.STYLE == 32), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, 'ヘッダー行が太い罫線（横線なし）', 'fStyle42', (global.STYLE == 42), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, '太い罫線（横線なし）', 'fStyle52', (global.STYLE == 52), JaneViewMenu.styleSelected);
			JaneViewMenu.addMenuItem(defstyles, 'ユーザー指定罫線（横線なし）', 'fStyle92', (global.STYLE == 92), JaneViewMenu.styleSelected);

			if (DEBUG) {
				JaneViewMenu.addMenuItem(root, '-', null, null, null);
				JaneViewMenu.addMenuItem(root, 'デバッグモード変換', null, null, function(o, t) {
					debug();
				});
			}
			JaneViewMenu.initialized = true;
		},
		styleSelected : function(o, t) {
			var matches = [];
			if (matches = o['GestureName'].match(/fStyle(\d+)/i)) {
				var num = parseInt(matches[1]);
				if (num == global.STYLE) { return; }
				for (var i = 0; i < JaneViewMenu.menuItem.length; i++) {
					var item = JaneViewMenu.menuItem[i];
					if (item['Gesturename'].match(/fStyle(\d+)/i)) {
						item['Checked'] = false;
					}
				}
				global.STYLE = num;
				o['Checked'] = true;
				JaneViewMenu.ini['Write']('General', 'STYLE', String(global.STYLE));
				JaneViewMenu.ini['UpdateFile']();
			}
		},
		selectedConvert : function(o, t) {
			var matches = [];
			if (matches = o['GestureName'].match(/ConvStyle(\d+)/i)) {
				global.Convert(parseInt(matches[1]));
			}
		}
	};
} else {
	if (v2c.context && v2c.context.args.length > 0) {
		var matches = [];
		var argLine = v2c.context.argLine;
		if (/\$USE_UNICODE/i.test(argLine)) {
			global.USE_UNICODE = true;
		}
		if (/\$TAILCUT/i.test(argLine)) {
			global.TAILCUT = true;
		}
		if (matches = /\$SEPARATOR\(([^\)]+)\)/i.exec(argLine)) {
			global.SEPARATOR = matches[1];
		}
		if (matches = /\$STYLE\((\d+)\)/i.exec(argLine)) {
			global.STYLE = parseInt(matches[1]);
		}
		if (/\$PREVIEW/i.test(argLine)) {
			global.PREVIEW = true;
		}
		if (/\$USER_KEISEN/i.test(argLine)) {
			global.USER_KEISEN = matches[1];
		}
	}
}

function main()
{
	if (JANEVIEW) {
		JaneViewMenu.init();
	} else {
		global.Convert(global.STYLE);
	}
}
function debug()
{
	if (JANEVIEW && (!JaneViewMenu.initialized)) { JaneViewMenu.init(); return; }
//	 非罫線モードで水平線タイプをできるようにする？
//	1行パターン
//	._AColumn___._BColumn＿＿＿＿＿＿＿._CColumn＿_._DColumn._EColumn＿＿＿＿＿＿＿＿＿＿＿＿＿＿＿
//	[AColumn. ][BColumn　　　　　　　　　 ][CColumn ][DColumn][EColumn　　　　　　　　　　　 ]
//	または
//	2行パターン
//	AColumn　|BColumn　　　　　　　　　..|Column　|DColumn|EColumn　　　　　　　　　　　　　　　　　　　　　 　 .
//	―――――――――――――――――――――――――――――――――――――――
//|>|あああああ|いい|
//|うう|CENTER:ええ&br;おお|~|
//|~|~|~|
//|~|>|かーかかか|
	var stime = new Date();
	var s = '';
	s += '|aaaa|bbb|ccc|h\n';
	s += '|naaa|>|aaa|\n';
	if (JANEVIEW) {
			var wform = JaneScript.WriteForm;
			wform.PageIndex = 0;
			var emes = wform.MsgBody;
			logFunc('debug', 'start');
			emes.Text = tablemaker.make(s, global.STYLE);
			wform.PageIndex = 1;
	} else {
		var wp;
		if (v2c.context) {
			wp = v2c.context.thread.openWritePanel();
		} else {
			// !!!!!!!!!! extern 未定義
			wp = v2c.resPane.selectedThread.openWritePanel();
		}
		wp.message.text = tablemaker.make(s, global.STYLE);
		wp.preview = global.PREVIEW;
	}
	var etime = new Date();
	log('completed. (処理時間: {0}ミリ秒)', etime - stime);
}
function timewatch()
{
	var stime = new Date();
	main();
	var etime = new Date();
	log('completed. (処理時間: {0}ミリ秒)', etime - stime);
}
if (JANEVIEW || v2c.context) {
	MODE();		// 外部コマンド及びJaneViewのエントリーポイント
} else {
	// 動的読み込みのエントリーポイント
	// returnObject.Config.Run()
	//v2c.putProperty('__V2C_SCRIPT_TABLE_MAKER_DYNAMIC__', this);
	return this;
}
})();